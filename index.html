<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ViralVault Store ‚Äî Itens & Brainrots</title>
  <meta name="description" content="ViralVault Store ‚Äî loja de itens/brainrots do Roblox. Compra simples via PIX, pedido com ID e entrega em at√© 24h."/>
  <style>
    :root{
      --bg:#f7f7fb;
      --card:#ffffffcc;
      --cardSolid:#fff;
      --line:#e9e9f2;
      --text:#101018;
      --muted:#5c5c76;
      --accent:#ff2d55;   /* red */
      --accent2:#ff6a88;
      --good:#16a34a;
      --bad:#ef4444;
      --shadow: 0 18px 45px rgba(17, 17, 34, .10);
      --shadow2: 0 10px 24px rgba(17, 17, 34, .10);
      --radius: 18px;
      --radius2: 26px;
      --max: 1120px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 420px at 10% 0%, rgba(255,45,85,.14), transparent 60%),
        radial-gradient(900px 520px at 90% 10%, rgba(255,106,136,.12), transparent 60%),
        radial-gradient(1200px 700px at 50% 120%, rgba(255,45,85,.08), transparent 60%),
        var(--bg);
      overflow-x:hidden;
    }
    a{color:inherit; text-decoration:none}
    button,input{font:inherit}
    .wrap{max-width:var(--max); margin:0 auto; padding:18px}
    /* Topbar */
    .topbar{
      position:sticky; top:0; z-index:50;
      background: rgba(247,247,251,.82);
      backdrop-filter: blur(12px);
      border-bottom:1px solid var(--line);
    }
    .topInner{display:flex; align-items:center; gap:12px; padding:12px 18px; max-width:var(--max); margin:0 auto;}
    .brand{display:flex; align-items:center; gap:10px; font-weight:1000; letter-spacing:-.2px}
    .mark{
      width:44px; height:44px; border-radius:14px;
      background: linear-gradient(135deg,var(--accent),var(--accent2));
      box-shadow: 0 12px 26px rgba(255,45,85,.22);
      display:grid; place-items:center; color:white;
      font-weight:1100;
    }
    .nav{margin-left:auto; display:flex; gap:10px; align-items:center}
    .nav a{
      padding:10px 12px; border-radius:999px;
      border:1px solid transparent;
      color:var(--muted); font-weight:900; font-size:13px;
    }
    .nav a:hover{border-color:var(--line); background:#fff}
    .btn{
      border:1px solid var(--line);
      background:#fff;
      padding:12px 14px;
      border-radius:14px;
      font-weight:1000;
      cursor:pointer;
      box-shadow: var(--shadow2);
      transition: transform .12s ease, filter .12s ease;
      display:inline-flex; align-items:center; gap:10px; justify-content:center;
    }
    .btn:active{transform: translateY(1px) scale(.99)}
    .btnPrimary{
      border:none;
      background: linear-gradient(90deg,var(--accent),var(--accent2));
      color:white;
      box-shadow: 0 16px 34px rgba(255,45,85,.22);
    }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 12px; border-radius:999px;
      background:#fff; border:1px solid var(--line);
      color:var(--muted); font-weight:950; font-size:12px;
      box-shadow: var(--shadow2);
    }
    .dot{width:10px; height:10px; border-radius:999px; background: var(--good)}
    /* Hero */
    .hero{
      margin-top: 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.92), rgba(255,255,255,.70));
      border:1px solid var(--line);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .hero::before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(700px 320px at 10% 10%, rgba(255,45,85,.16), transparent 60%),
        radial-gradient(700px 340px at 90% 10%, rgba(255,106,136,.14), transparent 60%);
      pointer-events:none;
    }
    .heroGrid{
      position:absolute; inset:0;
      background-image: linear-gradient(to right, rgba(16,16,24,.06) 1px, transparent 1px),
                        linear-gradient(to bottom, rgba(16,16,24,.05) 1px, transparent 1px);
      background-size: 58px 58px;
      mask-image: radial-gradient(closest-side, rgba(0,0,0,.50), transparent 72%);
      opacity:.45;
      pointer-events:none;
    }
    .heroInner{position:relative; padding:22px; display:grid; grid-template-columns: 1.25fr .75fr; gap:16px; align-items:center}
    h1{margin:10px 0 10px; font-size:42px; line-height:1.05; letter-spacing:-.8px}
    .sub{margin:0; color:var(--muted); font-weight:800; line-height:1.55; max-width:62ch}
    .cta{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px}
    .trust{display:grid; grid-template-columns: repeat(3,1fr); gap:10px; margin-top:14px}
    .tCard{
      background:#fff; border:1px solid var(--line);
      border-radius: 16px; padding:12px 12px;
      box-shadow: var(--shadow2);
      display:flex; gap:10px; align-items:flex-start;
    }
    .ico{
      width:40px; height:40px; border-radius:14px;
      background: rgba(255,45,85,.10);
      border:1px solid rgba(255,45,85,.18);
      display:grid; place-items:center;
      font-size:18px;
      flex:0 0 auto;
    }
    .tCard b{display:block; font-weight:1050}
    .tCard small{display:block; color:var(--muted); font-weight:850; margin-top:2px}
    /* Promo side */
    .promo{
      background:#fff;
      border:1px solid var(--line);
      border-radius: 22px;
      box-shadow: var(--shadow2);
      padding:14px;
    }
    .promoTitle{font-weight:1100; letter-spacing:-.2px; margin:0 0 8px}
    .promoRow{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .input{
      width:100%;
      padding:14px 14px;
      border-radius: 14px;
      border:1px solid var(--line);
      background:#fff;
      outline:none;
      font-weight:900;
    }
    .hint{color:var(--muted); font-weight:850; font-size:12px; margin-top:8px; line-height:1.4}
    /* Sections */
    .section{margin-top:18px}
    .sectionHead{display:flex; align-items:flex-end; justify-content:space-between; gap:12px}
    .sectionHead h2{margin:0; font-size:20px; letter-spacing:-.3px}
    .sectionHead p{margin:0; color:var(--muted); font-weight:850; font-size:13px}
    .grid{
      margin-top:12px;
      display:grid;
      grid-template-columns: repeat(3,1fr);
      gap:12px;
    }
    .card{
      background:#fff;
      border:1px solid var(--line);
      border-radius: 18px;
      box-shadow: var(--shadow2);
      overflow:hidden;
      position:relative;
    }
    .cardInner{padding:14px}
    .tag{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      border:1px solid var(--line); background: #fff;
      font-weight:950; font-size:12px; color:var(--muted)
    }
    .pTitle{margin:10px 0 6px; font-weight:1100; letter-spacing:-.2px}
    .pDesc{margin:0 0 10px; color:var(--muted); font-weight:850; font-size:13px; line-height:1.5}
    .row{display:flex; align-items:flex-end; justify-content:space-between; gap:10px; margin-top:6px}
    .price{font-weight:1150; font-size:20px}
    .muted{color:var(--muted); font-weight:900; font-size:12px}
    /* How it works */
    .steps{
      margin-top:12px;
      display:grid;
      grid-template-columns: repeat(3,1fr);
      gap:12px;
    }
    .step{
      background:#fff; border:1px solid var(--line);
      border-radius: 18px; box-shadow: var(--shadow2);
      padding:14px;
    }
    .num{
      width:40px; height:40px; border-radius:14px;
      background: linear-gradient(135deg, rgba(255,45,85,.18), rgba(255,106,136,.16));
      border:1px solid rgba(255,45,85,.20);
      display:grid; place-items:center; font-weight:1150;
      margin-bottom:10px;
    }
    .step b{display:block; font-weight:1100}
    .step small{display:block; color:var(--muted); font-weight:850; margin-top:6px; line-height:1.45}
    /* Reviews */
    .reviews{
      margin-top:12px;
      background:#fff; border:1px solid var(--line);
      border-radius: 22px; box-shadow: var(--shadow2);
      padding:14px;
    }
    .score{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .badge{
      padding:10px 12px; border-radius:999px;
      border:1px solid var(--line); background:#fff;
      font-weight:1050; color:var(--muted)
    }
    .revRow{display:grid; grid-template-columns: repeat(3,1fr); gap:12px; margin-top:12px}
    .rev{
      border:1px solid var(--line); border-radius: 18px;
      padding:12px; background: linear-gradient(180deg, #fff, #fff8fb);
    }
    .revTop{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .who{font-weight:1100}
    .ok{color:var(--good); font-weight:1100}
    .rev p{margin:10px 0 0; color:var(--muted); font-weight:850; line-height:1.5; font-size:13px}
    /* FAQ */
    .faq{margin-top:12px; display:grid; grid-template-columns: 1fr 1fr; gap:12px}
    details{
      background:#fff; border:1px solid var(--line); border-radius: 18px;
      box-shadow: var(--shadow2);
      padding:12px 14px;
    }
    summary{cursor:pointer; font-weight:1100}
    details p{margin:10px 0 0; color:var(--muted); font-weight:850; line-height:1.5; font-size:13px}
    /* Footer */
    footer{margin:20px 0 30px; color:var(--muted); font-weight:850}
    .foot{
      background:#fff; border:1px solid var(--line);
      border-radius: 22px; box-shadow: var(--shadow2);
      padding:14px;
      display:grid; grid-template-columns: 1.2fr .8fr; gap:12px;
    }
    .foot b{color:var(--text)}
    .pillWarn{
      margin-top:10px;
      padding:12px 12px;
      border-radius: 18px;
      border:1px dashed rgba(255,45,85,.35);
      background: rgba(255,45,85,.06);
      color: #7a1a2b;
      font-weight:1000;
      line-height:1.45;
    }
    /* Modal checkout */
    .overlay{position:fixed; inset:0; background: rgba(16,16,24,.55); display:none; align-items:center; justify-content:center; padding:16px; z-index:90}
    .modal{
      width:min(560px, 100%);
      background:#fff;
      border:1px solid var(--line);
      border-radius: 24px;
      box-shadow: 0 22px 70px rgba(0,0,0,.22);
      overflow:hidden;
    }
    .mTop{display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--line)}
    .mTop b{font-weight:1150}
    .x{width:44px; height:44px; border-radius:14px; border:1px solid var(--line); background:#fff; cursor:pointer; font-weight:1100}
    .mBody{padding:14px}
    .mGrid{display:grid; grid-template-columns: 1fr; gap:10px}
    .box{
      border:1px solid var(--line);
      border-radius: 18px;
      padding:12px;
      background: linear-gradient(180deg,#fff,#fff8fb);
    }
    .k{color:var(--muted); font-weight:950; font-size:12px}
    .v{font-weight:1100; margin-top:4px}
    .copyRow{display:flex; gap:10px; flex-wrap:wrap; margin-top:10px}
    .btnSmall{padding:11px 12px; border-radius: 14px; font-size:14px}
    .status{
      margin-top:10px;
      padding:12px 12px;
      border-radius: 18px;
      border:1px dashed var(--line);
      background:#fafafe;
      color:var(--muted);
      font-weight:1000;
      min-height:46px;
      display:flex; align-items:center;
    }
    .status.ok{border-color: rgba(22,163,74,.35); background: rgba(22,163,74,.08); color:#0f3d1f}
    .status.bad{border-color: rgba(239,68,68,.35); background: rgba(239,68,68,.08); color:#4a0e0e}
    /* WA */
    .wa{
      position:fixed; right:16px; bottom:16px; z-index:80;
      display:flex; gap:10px; align-items:center;
      padding:12px 12px;
      border-radius: 999px;
      background: linear-gradient(90deg,#16a34a,#22c55e);
      color:white; box-shadow: 0 18px 45px rgba(34,197,94,.20);
      font-weight:1100;
    }
    /* Responsive */
    @media (max-width: 980px){
      .heroInner{grid-template-columns:1fr}
      .grid{grid-template-columns:1fr}
      .trust{grid-template-columns:1fr}
      .steps{grid-template-columns:1fr}
      .revRow{grid-template-columns:1fr}
      .faq{grid-template-columns:1fr}
      h1{font-size:34px}
      .nav{display:none}
    }
  </style>
</head>
<body>
  <header class="topbar">
    <div class="topInner">
      <div class="brand">
        <div class="mark">VV</div>
        <div>
          <div style="line-height:1; font-size:14px; color:var(--muted); font-weight:950">Loja Digital</div>
          <div style="line-height:1.05; font-size:16px">ViralVault Store</div>
        </div>
      </div>

      <nav class="nav">
        <a href="#catalogo">Cat√°logo</a>
        <a href="#como">Como comprar</a>
        <a href="#avaliacoes">Avalia√ß√µes</a>
        <a href="#faq">FAQ</a>
      </nav>

      <div style="margin-left:auto; display:flex; gap:10px; align-items:center">
        <div class="chip"><span class="dot"></span> Entrega em at√© 24h</div>
        <button class="btn btnPrimary" id="btnCatalogoTop">Ver Cat√°logo</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <section class="hero" id="inicio">
      <div class="heroGrid"></div>
      <div class="heroInner">
        <div>
          <div class="chip">üî• Itens/Brainrots do Roblox ‚Ä¢ PIX</div>
          <h1>Compra simples, sem enrola√ß√£o.<br/>Paga e s√≥ espera a entrega.</h1>
          <p class="sub">
            Voc√™ escolhe o item, informa seu <b>usu√°rio do Roblox</b> e finaliza. O pedido gera um <b>ID</b> para acompanhar e comprovar.
          </p>

          <div class="cta">
            <button class="btn btnPrimary" id="btnVerCatalogo">üõçÔ∏è Ver cat√°logo</button>
            <button class="btn" id="btnComo">‚ú® Como funciona</button>
            <button class="btn" id="btnVerificar">üîé Verificar pedido</button>
          </div>

          <div class="trust">
            <div class="tCard"><div class="ico">üîí</div><div><b>Transparente</b><small>ID do pedido + status</small></div></div>
            <div class="tCard"><div class="ico">‚ö°</div><div><b>R√°pido</b><small>Fluxo simples (paga e pronto)</small></div></div>
            <div class="tCard"><div class="ico">üí¨</div><div><b>Suporte</b><small>WhatsApp direto</small></div></div>
          </div>
        </div>

        <aside class="promo" aria-label="Compra r√°pida">
          <p class="promoTitle">Compra r√°pida (1 clique)</p>
          <div class="promoRow">
            <label style="width:100%">
              <div class="k" style="margin-bottom:6px">Seu usu√°rio do Roblox</div>
              <input class="input" id="quickUser" placeholder="@user_1234" autocomplete="off"/>
            </label>
            <button class="btn btnPrimary" style="width:100%" id="btnQuickOpen">Escolher produto</button>
          </div>
          <div class="hint">
            ‚ö†Ô∏è <b>Anti-golpe:</b> a compra s√≥ √© v√°lida com <b>ID do pedido</b> gerado no site. N√£o aceite ‚Äúprints‚Äù sem ID.
          </div>
        </aside>
      </div>
    </section>

    <section class="section" id="catalogo">
      <div class="sectionHead">
        <div>
          <h2>Produtos em destaque</h2>
          <p>Cat√°logo puxado automaticamente do Worker</p>
        </div>
        <button class="btn" id="btnReload">Atualizar</button>
      </div>
      <div class="grid" id="productGrid" aria-live="polite"></div>
    </section>

    <section class="section" id="como">
      <div class="sectionHead">
        <div>
          <h2>Como √© f√°cil comprar</h2>
          <p>Processo r√°pido em 3 etapas</p>
        </div>
      </div>
      <div class="steps">
        <div class="step"><div class="num">1</div><b>Escolha o produto</b><small>Veja o cat√°logo e selecione o item/brainrot desejado.</small></div>
        <div class="step"><div class="num">2</div><b>Informe seu usu√°rio e pague</b><small>Digite seu usu√°rio do Roblox e finalize via PIX. Voc√™ recebe um <b>ID</b>.</small></div>
        <div class="step"><div class="num">3</div><b>Aguarde a entrega</b><small>Entrega em at√© <b>24h</b>. Se n√£o entregar, voc√™ tem <b>reembolso</b>.</small></div>
      </div>
    </section>

    <section class="section" id="avaliacoes">
      <div class="sectionHead">
        <div>
          <h2>Avalia√ß√µes dos clientes</h2>
          <p>Prova social (exemplo ‚Äî personalize depois)</p>
        </div>
      </div>
      <div class="reviews">
        <div class="score">
          <div class="badge">‚≠ê 4.9/5</div>
          <div class="badge">‚úÖ Compradores verificados</div>
          <div class="badge">üí¨ Suporte r√°pido</div>
        </div>
        <div class="revRow">
          <div class="rev"><div class="revTop"><div class="who">Jo√£o</div><div class="ok">‚úì</div></div><p>‚ÄúChegou certinho. Processo simples e o ID do pedido passa confian√ßa.‚Äù</p></div>
          <div class="rev"><div class="revTop"><div class="who">Carla</div><div class="ok">‚úì</div></div><p>‚ÄúGostei do atendimento. Paguei e s√≥ esperei a entrega, sem enrola√ß√£o.‚Äù</p></div>
          <div class="rev"><div class="revTop"><div class="who">Vini</div><div class="ok">‚úì</div></div><p>‚ÄúEntrega dentro do prazo. Achei top ter verifica√ß√£o do pedido.‚Äù</p></div>
        </div>
      </div>
    </section>

    <section class="section" id="faq">
      <div class="sectionHead">
        <div>
          <h2>D√∫vidas frequentes</h2>
          <p>Respostas r√°pidas para o cliente</p>
        </div>
      </div>
      <div class="faq">
        <details><summary>Como funciona a compra?</summary><p>Voc√™ escolhe o produto, informa seu usu√°rio e gera o pedido. Ap√≥s o pagamento via PIX, √© s√≥ aguardar a entrega (at√© 24h).</p></details>
        <details><summary>O que garante que n√£o √© golpe?</summary><p>O pedido gera um <b>ID</b> e status. Voc√™ pode verificar no site. Se algu√©m pedir fora do site, desconfie.</p></details>
        <details><summary>Quanto tempo para receber?</summary><p>At√© <b>24h</b>. Se passar do prazo, voc√™ pode solicitar <b>reembolso</b>.</p></details>
        <details><summary>Preciso falar com entregador?</summary><p>Na maioria dos casos, n√£o. Se precisar de confirma√ß√£o, o suporte chama voc√™ pelo WhatsApp.</p></details>
      </div>
    </section>

    <footer>
      <div class="foot">
        <div>
          <b>ViralVault Store</b><br/>
          <span>Suporte: WhatsApp</span><br/>
          <span>Brasil ‚Ä¢ Loja digital de itens/brainrots</span>
          <div class="pillWarn">
            ‚úÖ <b>Anti-golpe:</b> compras somente pelo site. <br/>
            Sempre pe√ßa o <b>ID do pedido</b>. Sem ID, n√£o √© compra.
          </div>
        </div>
        <div>
          <b>Links</b><br/><br/>
          <a href="#catalogo">Cat√°logo</a><br/>
          <a href="#como">Como comprar</a><br/>
          <a href="#faq">FAQ</a><br/>
          <a href="#inicio">Topo</a><br/>
          <p style="margin-top:10px; font-size:12px">¬© <span id="year"></span> ViralVault Store</p>
        </div>
      </div>
    </footer>
  </main>

  <a class="wa" id="waLink" href="#" target="_blank" rel="noopener">üí¨ Suporte no WhatsApp</a>

  <!-- Checkout modal -->
  <div class="overlay" id="ovl" role="dialog" aria-modal="true" aria-label="Checkout">
    <div class="modal">
      <div class="mTop">
        <b>Checkout (PIX) ‚Äî simples</b>
        <button class="x" id="close">‚úï</button>
      </div>
      <div class="mBody">
        <div class="mGrid">
          <div class="box">
            <div class="k">Produto</div>
            <div class="v" id="mProd">‚Äî</div>
            <div class="k" style="margin-top:8px">Pre√ßo</div>
            <div class="v" id="mPrice">‚Äî</div>
          </div>

          <div class="box">
            <div class="k">Seu usu√°rio do Roblox</div>
            <input class="input" id="mUser" placeholder="@user_1234"/>
            <div class="hint">Sem usu√°rio, n√£o d√° pra entregar. üòâ</div>
          </div>

          <button class="btn btnPrimary" id="btnCreate">Gerar pedido + PIX</button>

          <div class="box" id="pixBox" style="display:none">
            <div class="k">ID do pedido</div>
            <div class="v" id="mOrder">‚Äî</div>

            <div class="k" style="margin-top:10px">PIX copia e cola</div>
            <textarea class="input" id="mPix" rows="3" style="resize:vertical; font-weight:900"></textarea>

            <div class="copyRow">
              <button class="btn btnSmall" id="copyPix">Copiar PIX</button>
              <button class="btn btnSmall" id="copyOrder">Copiar ID</button>
              <a class="btn btnSmall" id="btnSupport" href="#" target="_blank" rel="noopener">Falar com suporte</a>
            </div>

            <div class="status" id="mStatus">Depois de pagar, √© s√≥ aguardar a entrega (at√© 24h).</div>
          </div>

          <div class="status bad" id="err" style="display:none"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ======= CONFIG =======
    const WORKER_BASE = "https://viralvault-sign.darlanana06.workers.dev";
    const WHATSAPP_NUMBER = "5511941598713"; // seu n√∫mero
    const SUPPORT_TEXT = (orderId) => encodeURIComponent(
      "Ol√°! Preciso de ajuda com meu pedido. ID: " + (orderId || "(ainda n√£o tenho)") + "\\nMeu user do Roblox: "
    );

    // Voc√™ pode trocar o PIX para vir do Worker depois.
    // Por enquanto: ser√° preenchido pelo /create-order (se seu Worker mandar), ou voc√™ coloca aqui fallback.
    const PIX_FALLBACK = "";

    // ======= HELPERS =======
    const $ = (id) => document.getElementById(id);
    const money = (v) => {
      try {
        const n = Number(v);
        if (Number.isFinite(n)) return n.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
      } catch(e){}
      return String(v || "");
    }
    function toast(msg){
      // micro toast simples
      const t = document.createElement("div");
      t.textContent = msg;
      t.style.cssText = "position:fixed;left:50%;bottom:92px;transform:translateX(-50%);background:#111; color:#fff; padding:10px 12px; border-radius:999px; font-weight:900; z-index:9999; box-shadow: 0 12px 34px rgba(0,0,0,.25);";
      document.body.appendChild(t);
      setTimeout(()=>t.remove(), 1600);
    }
    async function copyText(txt){
      try{
        await navigator.clipboard.writeText(txt);
        toast("Copiado ‚úÖ");
      }catch(e){
        // fallback
        const ta = document.createElement("textarea");
        ta.value = txt;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        toast("Copiado ‚úÖ");
      }
    }

    // ======= STATE =======
    let catalog = [];
    let selected = null;

    // ======= UI NAV =======
    $("btnVerCatalogo").onclick = () => document.querySelector("#catalogo").scrollIntoView({behavior:"smooth"});
    $("btnCatalogoTop").onclick = () => document.querySelector("#catalogo").scrollIntoView({behavior:"smooth"});
    $("btnComo").onclick = () => document.querySelector("#como").scrollIntoView({behavior:"smooth"});
    $("btnVerificar").onclick = () => {
      toast("Verifica√ß√£o p√∫blica: use o ID do pedido");
      document.querySelector("#faq").scrollIntoView({behavior:"smooth"});
    };

    $("year").textContent = new Date().getFullYear();

    // WhatsApp link
    const waBase = "https://wa.me/" + WHATSAPP_NUMBER + "?text=";
    $("waLink").href = waBase + SUPPORT_TEXT("");

    // ======= MODAL =======
    function openModal(prod){
      selected = prod;
      $("mProd").textContent = prod?.name || prod?.title || "Produto";
      $("mPrice").textContent = money(prod?.price ?? prod?.valor ?? "");
      $("mUser").value = $("quickUser").value || "";
      $("err").style.display = "none";
      $("pixBox").style.display = "none";
      $("mPix").value = "";
      $("mOrder").textContent = "‚Äî";
      $("mStatus").className = "status";
      $("mStatus").textContent = "Depois de pagar, √© s√≥ aguardar a entrega (at√© 24h).";
      $("ovl").style.display = "flex";
      $("mUser").focus();
    }
    function closeModal(){ $("ovl").style.display = "none"; }
    $("close").onclick = closeModal;
    $("ovl").addEventListener("click", (e)=>{ if(e.target === $("ovl")) closeModal(); });

    $("btnQuickOpen").onclick = () => {
      document.querySelector("#catalogo").scrollIntoView({behavior:"smooth"});
      toast("Escolha um produto abaixo üëá");
    };

    // ======= LOAD CATALOG =======
    async function loadCatalog(){
      $("productGrid").innerHTML = '<div class="card"><div class="cardInner"><div class="tag">Carregando‚Ä¶</div><div class="pTitle">Buscando cat√°logo</div><div class="pDesc">Aguarde‚Ä¶</div></div></div>';
      try{
        const r = await fetch(WORKER_BASE + "/catalog", {method:"GET"});
        const data = await r.json();
        const items = data?.items || data?.products || data || [];
        catalog = Array.isArray(items) ? items : [];
        renderCatalog();
      }catch(e){
        $("productGrid").innerHTML = '<div class="card"><div class="cardInner"><div class="tag">Erro</div><div class="pTitle">N√£o deu pra carregar</div><div class="pDesc">Verifique se o Worker est√° online e se /catalog existe.</div></div></div>';
      }
    }

    function renderCatalog(){
      const grid = $("productGrid");
      if(!catalog.length){
        grid.innerHTML = '<div class="card"><div class="cardInner"><div class="tag">Vazio</div><div class="pTitle">Sem produtos</div><div class="pDesc">Adicione produtos no Worker (products).</div></div></div>';
        return;
      }
      grid.innerHTML = "";
      for(const p of catalog.slice(0, 12)){
        const name = p.name || p.title || "Produto";
        const desc = p.desc || p.description || "Entrega em at√© 24h.";
        const badge = p.badge || p.game || "Digital";
        const price = money(p.price ?? p.valor ?? "");
        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `
          <div class="cardInner">
            <div class="tag">‚ú® ${escapeHtml(badge)}</div>
            <div class="pTitle">${escapeHtml(name)}</div>
            <div class="pDesc">${escapeHtml(desc)}</div>
            <div class="row">
              <div>
                <div class="price">${escapeHtml(price)}</div>
                <div class="muted">Entrega: at√© 24h</div>
              </div>
              <button class="btn btnPrimary btnSmall">Comprar</button>
            </div>
          </div>
        `;
        el.querySelector("button").onclick = () => openModal(p);
        grid.appendChild(el);
      }
    }

    function escapeHtml(s){
      return String(s ?? "").replace(/[&<>"']/g, (m)=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;" }[m]));
    }

    $("btnReload").onclick = loadCatalog;

    // ======= CREATE ORDER =======
    $("btnCreate").onclick = async () => {
      const user = $("mUser").value.trim();
      if(!user){
        $("err").style.display = "block";
        $("err").textContent = "Preencha seu usu√°rio (ex: @user_1234).";
        return;
      }
      $("err").style.display = "none";
      $("btnCreate").disabled = true;
      $("btnCreate").textContent = "Gerando‚Ä¶";

      try{
        // payload flex√≠vel (o Worker pode aceitar productId/name/price)
        const body = {
          user,
          productId: selected?.id || selected?.sku || selected?.slug || null,
          productName: selected?.name || selected?.title || "Produto",
          price: selected?.price ?? selected?.valor ?? null
        };

        const r = await fetch(WORKER_BASE + "/create-order", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify(body)
        });
        const data = await r.json();

        if(!r.ok || data?.ok === false){
          throw new Error(data?.error || "Falha ao criar pedido");
        }

        const orderId = data.orderId || data.id || data.order || "";
        const pix = data.pix || data.pixCopiaECola || data.pix_payload || PIX_FALLBACK;

        $("pixBox").style.display = "block";
        $("mOrder").textContent = orderId || "(sem id)";
        $("mPix").value = pix || "";

        // suporte link com contexto
        $("btnSupport").href = waBase + encodeURIComponent(
          "Ol√°! Fiz um pedido na ViralVault Store.\n" +
          "ID: " + (orderId || "(sem id)") + "\n" +
          "User Roblox: " + user + "\n" +
          "Produto: " + (selected?.name || selected?.title || "Produto")
        );

        $("mStatus").className = "status ok";
        $("mStatus").textContent = "Pedido criado ‚úÖ Pague via PIX e aguarde a entrega (at√© 24h).";

        // opcional: poll status
        if(orderId){
          pollStatus(orderId);
        }
      }catch(e){
        $("err").style.display = "block";
        $("err").textContent = String(e?.message || e);
      }finally{
        $("btnCreate").disabled = false;
        $("btnCreate").textContent = "Gerar pedido + PIX";
      }
    };

    $("copyPix").onclick = () => copyText($("mPix").value || "");
    $("copyOrder").onclick = () => copyText($("mOrder").textContent || "");

    async function pollStatus(orderId){
      // poll leve: 1x a cada 6s, por 5 min
      const start = Date.now();
      const interval = 6000;
      const max = 5 * 60 * 1000;

      async function tick(){
        if(Date.now() - start > max) return;
        try{
          const r = await fetch(WORKER_BASE + "/order-status?orderId=" + encodeURIComponent(orderId));
          const data = await r.json();
          const st = (data.status || data.state || "").toLowerCase();
          if(st.includes("paid") || st.includes("pago")){
            $("mStatus").className = "status ok";
            $("mStatus").textContent = "Pagamento confirmado ‚úÖ Agora √© s√≥ aguardar a entrega.";
          }
          if(st.includes("delivered") || st.includes("entreg")){
            $("mStatus").className = "status ok";
            $("mStatus").textContent = "Entregue ‚úÖ Obrigado pela compra!";
            return;
          }
        }catch(e){}
        setTimeout(tick, interval);
      }
      setTimeout(tick, interval);
    }

    // init
    loadCatalog();
  </script>
</body>
</html>
