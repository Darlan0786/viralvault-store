<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title><span data-i18n="brand_name">ViralVault Store</span></title>
  <meta name="description" content="Loja digital de Roblox com checkout via PIX e verifica√ß√£o por Order ID." />
  <meta name="theme-color" content="#0b1020" />
  <meta property="og:title" content="<span data-i18n="brand_name">ViralVault Store</span>" />
  <meta property="og:description" content="Checkout PIX + verifica√ß√£o por Order ID + suporte no WhatsApp." />
  <meta property="og:type" content="website" />
  <style>
    :root {
      --bg0:#070a12;
      --bg1:#0b1020;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.085);
      --stroke:rgba(255,255,255,.12);
      --text:#eaf0ff;
      --muted:rgba(234,240,255,.72);
      --muted2:rgba(234,240,255,.52);
      --brand:#7b61ff;          /* roxo principal estilo Virtualities */
      --brand2:#36d1dc;         /* ciano */
      --ok:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --shadow: 0 20px 60px rgba(0,0,0,.45);
      --r:18px;
      --r2:26px;
      --safeB: env(safe-area-inset-bottom, 0px);
      --safeT: env(safe-area-inset-top, 0px);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font: 500 15px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Arial, "Helvetica Neue";
      background:
        radial-gradient(1200px 500px at 10% -10%, rgba(123,97,255,.35), transparent 60%),
        radial-gradient(1000px 520px at 100% 0%, rgba(54,209,220,.20), transparent 60%),
        radial-gradient(900px 600px at 40% 110%, rgba(239,68,68,.12), transparent 60%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      overflow-x:hidden;
      padding-bottom: calc(92px + var(--safeB));
    }

    a{color:inherit; text-decoration:none}
    .wrap{max-width:1100px; margin:0 auto; padding:18px 14px 120px}
    .topbar{
      position:sticky; top:0; z-index:50;
      padding-top: var(--safeT);
      backdrop-filter: blur(14px);
      background: linear-gradient(180deg, rgba(7,10,18,.86), rgba(7,10,18,.55));
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    .topbarInner{max-width:1100px; margin:0 auto; padding:12px 14px; display:flex; align-items:center; gap:12px}
    .brand{display:flex; align-items:center; gap:10px; min-width:170px}
    .logo{
      width:42px; height:42px; border-radius:14px;
      background: linear-gradient(135deg, rgba(123,97,255,1), rgba(54,209,220,1));
      display:grid; place-items:center; font-weight:900;
      box-shadow: 0 10px 30px rgba(123,97,255,.25);
    }
    .brandTitle{display:flex; flex-direction:column; line-height:1.05}
    .brandTitle b{font-size:15px}
    .brandTitle span{font-size:12px; color:var(--muted2)}

    .search{
      flex:1;
      display:flex; align-items:center; gap:10px;
      padding:10px 12px;
      border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
    }
    .search input{
      width:100%;
      border:0; outline:0;
      background:transparent;
      color:var(--text);
      font-size:14px;
    }
    .iconBtn{
      width:44px; height:44px;
      border-radius:14px;
      display:grid; place-items:center;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      cursor:pointer;
    }
    .badge{
      position:absolute; transform: translate(15px,-12px);
      min-width:18px; height:18px; padding:0 6px;
      border-radius:999px;
      display:grid; place-items:center;
      background: var(--danger);
      font-size:11px; font-weight:800;
      border:2px solid rgba(7,10,18,.9);
    }

    /* Hero estilo Virtualities */
    .hero{
      margin-top:14px;
      border-radius: var(--r2);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(800px 340px at 25% 20%, rgba(123,97,255,.38), transparent 60%),
        radial-gradient(900px 420px at 90% 10%, rgba(54,209,220,.22), transparent 60%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.04));
      box-shadow: var(--shadow);
      position:relative;
    }
    .hero::before{
      content:"";
      position:absolute; inset:0;
      background:
        linear-gradient(180deg, rgba(7,10,18,.08), rgba(7,10,18,.65));
      pointer-events:none;
    }
    .heroInner{position:relative; padding:26px 18px}
    .pill{
      display:inline-flex; gap:10px; align-items:center;
      padding:10px 14px;
      border-radius:999px;
      background: rgba(123,97,255,.14);
      border: 1px solid rgba(123,97,255,.35);
      color: rgba(234,240,255,.92);
      font-weight:800;
    }
    .pill .dot{width:9px; height:9px; border-radius:999px; background: var(--ok); box-shadow:0 0 0 5px rgba(34,197,94,.16)}
    h1{margin:14px 0 8px; font-size:44px; line-height:1.03; letter-spacing:-.02em}
    .sub{color:var(--muted); font-size:16px; max-width:64ch}
    .ctaRow{display:flex; gap:12px; flex-wrap:wrap; margin-top:16px}
    .btn{
      border:0;
      border-radius: 16px;
      padding:12px 16px;
      display:inline-flex; align-items:center; gap:10px;
      cursor:pointer;
      font-weight:900;
      letter-spacing:.01em;
      transition:.15s transform, .15s opacity;
    }
    .btn:active{transform:translateY(1px)}
    .btnPrimary{
      background: linear-gradient(135deg, var(--brand), #a78bfa);
      color:#0b1020;
      box-shadow: 0 12px 30px rgba(123,97,255,.25);
    }
    .btnGhost{
      background: rgba(255,255,255,.06);
      color:var(--text);
      border:1px solid rgba(255,255,255,.12);
    }

    .grid{display:grid; grid-template-columns: 1.2fr .8fr; gap:14px; margin-top:14px}
    .card{
      border-radius: var(--r);
      background: rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.10);
      box-shadow: 0 18px 50px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .cardHd{padding:14px 14px 0}
    .cardHd h2{margin:0; font-size:18px}
    .cardHd p{margin:6px 0 0; color:var(--muted2)}
    .cardBd{padding:14px}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    label{display:block; font-size:12px; color:var(--muted2); margin:0 0 6px}
    .inp{
      width:100%;
      padding:12px 12px;
      border-radius: 14px;
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.12);
      color:var(--text);
      outline:none;
    }
    .mini{font-size:12px; color:var(--muted2)}

    /* Cat√°logo */
    .sectionTitle{display:flex; align-items:flex-end; justify-content:space-between; margin:18px 0 10px}
    .sectionTitle h3{margin:0; font-size:16px}
    .sectionTitle span{color:var(--muted2); font-size:12px}
    .cats{display:flex; gap:10px; overflow:auto; padding-bottom:6px}
    .chip{
      flex:0 0 auto;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color:var(--muted);
      cursor:pointer;
      user-select:none;
      font-weight:800;
    }
    .chip.active{background: rgba(123,97,255,.16); border-color: rgba(123,97,255,.35); color:rgba(234,240,255,.95)}

    .products{display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:12px}
    .p{
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.05);
      cursor:pointer;
      transition:.15s transform, .15s opacity;
    }
    .p:active{transform:translateY(1px)}
    .pImg{
      height:120px;
      background: radial-gradient(400px 140px at 20% 20%, rgba(123,97,255,.25), transparent 60%),
                  radial-gradient(450px 160px at 90% 0%, rgba(54,209,220,.18), transparent 60%),
                  linear-gradient(180deg, rgba(255,255,255,.05), rgba(0,0,0,.12));
      display:flex; align-items:flex-end; padding:10px;
    }
    .tag{
      font-size:11px; font-weight:900;
      padding:6px 10px; border-radius:999px;
      background: rgba(0,0,0,.38);
      border:1px solid rgba(255,255,255,.10);
      color: rgba(234,240,255,.9);
      backdrop-filter: blur(10px);
    }
    .pBody{padding:10px}
    .pName{font-weight:900; margin:0 0 6px}
    .pMeta{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .price{font-weight:1000}
    .muted{color:var(--muted2); font-size:12px}

    /* Drawer carrinho */
    .overlay{position:fixed; inset:0; background: rgba(0,0,0,.55); display:none; z-index:2000}
    .drawer{
      position:fixed; right:0; top:0; height:100%; width:min(420px, 92vw);
      background: rgba(7,10,18,.92);
      backdrop-filter: blur(18px);
      border-left:1px solid rgba(255,255,255,.10);
      transform: translateX(110%);
      transition:.2s transform;
      z-index:2100;
      padding: 16px 14px calc(18px + var(--safeB));
      display:flex; flex-direction:column; gap:12px;
    }
    .drawer.open{transform:translateX(0)}
    .overlay.show{display:block}
    .drawerTop{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .x{width:44px; height:44px; border-radius:14px; border:1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.06); color:var(--text); cursor:pointer}
    .cartList{display:flex; flex-direction:column; gap:10px; overflow:auto; padding-right:2px}
    .cartItem{display:flex; gap:10px; padding:10px; border-radius:16px; background: rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.10)}
    .ciBox{width:52px; height:52px; border-radius:14px; background: rgba(123,97,255,.18); border:1px solid rgba(123,97,255,.25)}
    .ciInfo{flex:1}
    .ciInfo b{display:block}
    .qty{display:flex; align-items:center; gap:8px}
    .qbtn{width:34px; height:34px; border-radius:12px; border:1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.06); color:var(--text); cursor:pointer}
    .sum{margin-top:auto; border-top:1px solid rgba(255,255,255,.10); padding-top:12px}
    .sumRow{display:flex; justify-content:space-between; align-items:center}

    /* Checkout wizard */
    .steps{display:flex; gap:8px}
    .step{flex:1; padding:9px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.10); background: rgba(255,255,255,.06); color:var(--muted2); font-weight:900; font-size:12px; text-align:center}
    .step.on{background: rgba(123,97,255,.16); border-color: rgba(123,97,255,.35); color: rgba(234,240,255,.95)}
    .hide{display:none !important}

    /* Bottom nav estilo app */
    #bottomNav{
      position:fixed; left:0; right:0; bottom:0;
      padding: 10px 12px calc(10px + var(--safeB));
      z-index:1200;
      pointer-events:none;
    }
    #bottomNav .bar{
      pointer-events:auto;
      max-width: 560px;
      margin:0 auto;
      display:flex; gap:8px;
      padding:10px;
      border-radius: 22px;
      background: rgba(7,10,18,.72);
      border:1px solid rgba(255,255,255,.10);
      backdrop-filter: blur(16px);
      box-shadow: 0 16px 50px rgba(0,0,0,.45);
    }
    .navBtn{
      flex:1;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(255,255,255,.06);
      color: rgba(234,240,255,.82);
      border-radius: 18px;
      padding:10px 10px;
      cursor:pointer;
      font-weight:900;
      font-size:12px;
      display:flex; flex-direction:column; gap:4px; align-items:center; justify-content:center;
    }
    .navBtn.on{background: rgba(123,97,255,.16); border-color: rgba(123,97,255,.35); color: rgba(234,240,255,.95)}

    /* WhatsApp float (apenas 1, sem duplicar) */
    #wppFloat{
      position:fixed; right:16px;
      bottom: calc(92px + 16px + var(--safeB));
      z-index:1300;
    }
    #wppFloat button{
      border:0; cursor:pointer;
      padding:12px 14px;
      border-radius: 18px;
      display:flex; align-items:center; gap:10px;
      font-weight:1000;
      color:#06220f;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      box-shadow: 0 18px 45px rgba(34,197,94,.25);
    }

    /* Responsive */
    @media(max-width:860px){
      .grid{grid-template-columns:1fr}
      h1{font-size:38px}
      .products{grid-template-columns: repeat(2, minmax(0,1fr));}
      .brand{min-width:auto}
      .brandTitle span{display:none}
      .search{display:none} /* estilo Virtualities mobile: foco no conte√∫do */
    }
    @media(max-width:390px){
      h1{font-size:34px}
      .products{grid-template-columns:1fr}
    }

    /* Toast */
    #toast{position:fixed; left:50%; transform:translateX(-50%); bottom: calc(92px + 22px + var(--safeB));
      background: rgba(0,0,0,.55); border:1px solid rgba(255,255,255,.12); color: rgba(234,240,255,.92);
      padding:10px 12px; border-radius:999px; z-index:1400; display:none; backdrop-filter: blur(10px);
      max-width:min(92vw,520px); text-align:center;
    }
  
/* ===== ViralVault: Drawer Menu + i18n Switch ===== */
:root{
  --vvDrawerW: 320px;
  --vvOverlay: rgba(0,0,0,.55);
}
.vvIconBtn{
  appearance:none;border:0;outline:0;background:rgba(255,255,255,.06);
  color:var(--vvText,#fff); padding:10px 12px; border-radius:14px;
  display:inline-flex; align-items:center; gap:10px; cursor:pointer;
  box-shadow: 0 10px 30px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.08);
  backdrop-filter: blur(14px);
}
.vvIconBtn:active{transform:translateY(1px);}
.vvTopActions{display:flex; gap:10px; align-items:center;}
.vvMenuOverlay{
  position:fixed; inset:0; background:var(--vvOverlay);
  opacity:0; pointer-events:none; transition:opacity .22s ease;
  z-index: 3000;
}
.vvDrawer{
  position:fixed; top:0; bottom:0; right:0;
  width:min(var(--vvDrawerW), 92vw);
  transform:translateX(110%);
  transition:transform .26s cubic-bezier(.2,.9,.2,1);
  z-index: 3001;
  background: rgba(16,20,28,.86);
  border-left:1px solid rgba(255,255,255,.08);
  box-shadow: -30px 0 80px rgba(0,0,0,.45);
  backdrop-filter: blur(18px);
  padding: 18px;
  overflow:auto;
}
.vvDrawer.open{transform:translateX(0);}
.vvMenuOverlay.open{opacity:1; pointer-events:auto;}
.vvDrawerHeader{display:flex; align-items:center; justify-content:space-between; gap:12px;}
.vvDrawerTitle{font-size:22px; font-weight:800; letter-spacing:.2px;}
.vvDrawerClose{background:transparent;border:0;color:#fff;font-size:24px;cursor:pointer;padding:6px 10px;border-radius:12px;}
.vvProfileCard{
  margin-top:14px;
  padding:14px;
  border-radius:18px;
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.09);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
  display:flex; align-items:center; gap:12px;
}
.vvAvatar{
  width:44px;height:44px;border-radius:14px;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.35), rgba(255,255,255,.06));
  border:1px solid rgba(255,255,255,.14);
  display:flex; align-items:center; justify-content:center;
  font-weight:900;
}
.vvProfileMeta{min-width:0}
.vvProfileName{font-weight:800; line-height:1.1;}
.vvProfileSub{opacity:.72; font-size:13px; margin-top:3px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}
.vvDrawerList{margin-top:18px; display:flex; flex-direction:column; gap:10px;}
.vvDrawerItem{
  width:100%;
  display:flex; align-items:center; gap:12px;
  padding:12px 12px;
  border-radius:16px;
  background: rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.08);
  color:#fff;
  cursor:pointer;
}
.vvDrawerItem:hover{background: rgba(255,255,255,.06);}
.vvDrawerItem .ic{width:22px; height:22px; display:inline-flex; align-items:center; justify-content:center; opacity:.92;}
.vvSectionLabel{margin-top:18px; opacity:.7; font-weight:700; font-size:12px; letter-spacing:.14em; text-transform:uppercase;}
.vvSocialRow{display:flex; gap:12px; margin-top:10px;}
.vvSocialBtn{
  width:44px;height:44px;border-radius:16px;
  background: rgba(255,255,255,.06);
  border:1px solid rgba(255,255,255,.10);
  display:inline-flex; align-items:center; justify-content:center;
  color:#fff; cursor:pointer;
}
.vvLangModalOverlay{
  position:fixed; inset:0; background:rgba(0,0,0,.55);
  opacity:0; pointer-events:none; transition:opacity .2s ease;
  z-index: 4000;
}
.vvLangModal{
  position:fixed; left:50%; top:50%;
  transform: translate(-50%, -50%) scale(.98);
  width:min(520px, 92vw);
  background: rgba(16,20,28,.92);
  border:1px solid rgba(255,255,255,.10);
  border-radius:22px;
  box-shadow: 0 30px 120px rgba(0,0,0,.55);
  padding: 16px;
  opacity:0; pointer-events:none;
  transition:opacity .2s ease, transform .2s ease;
  z-index: 4001;
  backdrop-filter: blur(18px);
}
.vvLangModalOverlay.open{opacity:1; pointer-events:auto;}
.vvLangModal.open{opacity:1; pointer-events:auto; transform: translate(-50%, -50%) scale(1);}
.vvLangHead{display:flex; align-items:center; justify-content:space-between; gap:12px; padding: 6px 6px 10px;}
.vvLangHead h3{margin:0; font-size:18px;}
.vvLangGrid{display:grid; grid-template-columns: 1fr; gap:10px; padding: 6px;}
@media(min-width:480px){.vvLangGrid{grid-template-columns:1fr 1fr 1fr;}}
.vvLangCard{
  padding:12px;
  border-radius:18px;
  border:1px solid rgba(255,255,255,.10);
  background: rgba(255,255,255,.05);
  cursor:pointer;
}
.vvLangCard strong{display:block; font-size:14px;}
.vvLangCard span{display:block; opacity:.75; font-size:12px; margin-top:2px;}
.vvLangCard.active{outline:2px solid rgba(255,215,0,.55); background: rgba(255,215,0,.08);}


    /* Purchases list */
    .vvList{display:flex;flex-direction:column;gap:12px}
    .vvListItem{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:14px 14px;border-radius:16px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08)}
    .vvListMain{min-width:0;display:flex;flex-direction:column;gap:4px}
    .vvListTitle{font-weight:800;letter-spacing:.2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .vvListMeta{font-size:.92rem;color:rgba(255,255,255,.72);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .vvListActions{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .vvEmpty{padding:28px;border-radius:18px;border:1px dashed rgba(255,255,255,.18);background:rgba(255,255,255,.03);text-align:center}
    .vvEmptyIcon{font-size:34px;margin-bottom:8px}
    .vvEmptyTitle{font-weight:900;font-size:1.05rem}
    .vvEmptySub{color:rgba(255,255,255,.72);margin:6px 0 14px}
    
</style>
</head>

<body>

<div class="vvTopActions">
  <button class="vvIconBtn" id="vvMenuBtn" aria-label="Menu">‚ò∞ <span data-i18n="menu_title">Menu</span></button>
  <button class="vvIconBtn" id="vvLangBtn" aria-label="Idioma">üåê <span data-i18n="menu_language">Idioma</span></button>
</div>



<!-- ===== Drawer Menu (Virtualities-style) ===== -->
<div id="vvMenuOverlay" class="vvMenuOverlay" aria-hidden="true"></div>
<aside id="vvDrawer" class="vvDrawer" aria-label="Menu">
  <div class="vvDrawerHeader">
    <div class="vvDrawerTitle" data-i18n="menu_title">Menu</div>
    <button class="vvDrawerClose" id="vvDrawerClose" aria-label="Fechar">√ó</button>
  </div>

  <div class="vvProfileCard">
    <div class="vvAvatar" id="vvAvatar">VV</div>
    <div class="vvProfileMeta">
      <div class="vvProfileName" id="vvProfileName">ViralVault</div>
      <div class="vvProfileSub" id="vvProfileSub" data-i18n="menu_profile_sub">Loja digital ‚Ä¢ PIX ‚Ä¢ verifica√ß√£o</div>
    </div>
  </div>

  <div class="vvDrawerList">
    <button class="vvDrawerItem" data-go="catalog">
      <span class="ic">‚≠ê</span><span data-i18n="menu_catalog">Cat√°logos</span>
    </button>
    <button class="vvDrawerItem" data-go="support">
      <span class="ic">‚ùì</span><span data-i18n="menu_support">Suporte</span>
    </button>
    <button class="vvDrawerItem" data-go="cart">
      <span class="ic">üõí</span><span data-i18n="menu_cart">Carrinho</span>
    </button>
    <button class="vvDrawerItem" data-go="orders">
      <span class="ic">üßæ</span><span data-i18n="menu_orders">Meus Pedidos</span>
    </button>
    <button class="vvDrawerItem" id="vvOpenLang">
      <span class="ic">üåê</span><span data-i18n="menu_language">Idioma</span>
    </button>
  </div>

  <div class="vvSectionLabel" data-i18n="menu_social">Redes Sociais</div>
  <div class="vvSocialRow">
    <button class="vvSocialBtn" id="vvSocIG" aria-label="Instagram">‚åÅ</button>
    <button class="vvSocialBtn" id="vvSocDC" aria-label="Discord">‚åÅ</button>
  </div>

  <div class="vvSectionLabel" style="margin-top:18px;" data-i18n="menu_account">Conta</div>
  <button class="vvDrawerItem" data-go="profile">
    <span class="ic">üë§</span><span data-i18n="menu_profile">Meu Perfil</span>
  </button>
  <button class="vvDrawerItem" id="vvLogoutBtn">
    <span class="ic">‚Ü©</span><span data-i18n="menu_exit">Sair</span>
  </button>
</aside>

<!-- ===== Language Modal ===== -->
<div id="vvLangOverlay" class="vvLangModalOverlay" aria-hidden="true"></div>
<div id="vvLangModal" class="vvLangModal" role="dialog" aria-modal="true" aria-label="Idioma">
  <div class="vvLangHead">
    <h3 data-i18n="lang_title">Escolha o idioma</h3>
    <button class="vvDrawerClose" id="vvLangClose" aria-label="Fechar">√ó</button>
  </div>
  <div class="vvLangGrid" id="vvLangGrid">
    <div class="vvLangCard" data-lang="pt-BR"><strong>Portugu√™s (Brasil)</strong><span data-i18n="lang_pt">Padr√£o</span></div>
    <div class="vvLangCard" data-lang="en"><strong>English</strong><span data-i18n="lang_en">International</span></div>
    <div class="vvLangCard" data-lang="es"><strong>Espa√±ol</strong><span data-i18n="lang_es">LatAm</span></div>
  </div>
</div>


  <div class="topbar">
    <div class="topbarInner">
      <div class="brand" role="button" tabindex="0" onclick="go('home')">
        <div class="logo">VV</div>
        <div class="brandTitle">
          <b><span data-i18n="brand_name">ViralVault Store</span></b>
          <span>loja digital ‚Ä¢ PIX ‚Ä¢ verifica√ß√£o Order ID</span>
        </div>
      </div>

      <div class="search" title="Buscar no cat√°logo">
        üîé <input id="q" placeholder="Buscar produto, jogo ou categoria..." />
      </div>

      <div style="position:relative">
        <button class="iconBtn" id="cartBtn" aria-label="Carrinho" onclick="openCart()">üõí</button>
        <div class="badge" id="cartBadge" style="display:none">0</div>
      </div>
      <button class="iconBtn" id="statusBtn" aria-label="Pedido" onclick="go('pedido')">üì¶</button>
    </div>
  </div>

  <div class="wrap">
    <section class="hero" id="home">
      <div class="heroInner">
        <div class="pill"><span class="dot"></span> Checkout PIX ‚Ä¢ Verifica√ß√£o Order ID ‚Ä¢ Anti-golpe</div>
        <h1>Turbine seus itens do <span style="color:#a78bfa">Roblox</span>.</h1>
        <div class="sub">
          Compra r√°pida, entrega organizada e suporte no WhatsApp. Gere seu pedido, pague via PIX e acompanhe tudo pelo <b>Order ID</b>.
        </div>
        <div class="ctaRow">
          <button class="btn btnPrimary" onclick="go('catalogo')">üõçÔ∏è <span data-i18n="cta_catalog">Ver cat√°logo</span></button>
          <button class="btn btnGhost" onclick="go('checkout')">üßæ <span data-i18n="cta_checkout">Ir pro checkout</span></button>
          <button class="btn btnGhost" onclick="go('pedido')">üîé <span data-i18n="cta_order">Ver pedido</span></button>
        </div>
      </div>
    </section>

    <div class="grid">
      <section class="card" id="catalogo">
        <div class="cardHd">
          <h2>Cat√°logo</h2>
          <p>Toque em uma categoria e escolha o que voc√™ quer comprar.</p>
        </div>
        <div class="cardBd">
          <div class="sectionTitle">
            <h3>Categorias</h3>
            <span id="catHint">Carregando‚Ä¶</span>
          </div>
          <div class="cats" id="cats"></div>

          <div class="sectionTitle">
            <h3>Produtos</h3>
            <span id="pCount">0</span>
          </div>
          <div class="products" id="products"></div>

          <div class="mini" id="catSource" style="margin-top:10px"></div>
        </div>
      </section>

      <section class="card" id="checkout">
        <div class="cardHd">
          <h2>Checkout (1/2/3)</h2>
          <p>Finaliza em etapas ‚Äî simples e sem confus√£o.</p>
        </div>

        <div class="cardBd">
          <div class="steps" style="margin-bottom:12px">
            <div class="step on" id="s1">1 ‚Ä¢ Dados</div>
            <div class="step" id="s2">2 ‚Ä¢ Revis√£o</div>
            <div class="step" id="s3">3 ‚Ä¢ PIX</div>
          </div>

          <div id="step1">
            <label>Seu user do Roblox (obrigat√≥rio)</label>
            <input class="inp" id="robloxUser" placeholder="Ex: Darlan0786" autocomplete="off" />
            <div class="mini" style="margin-top:8px">Dica: s√≥ letras, n√∫meros e _ (3‚Äì20 caracteres).</div>
            <div class="row" style="margin-top:12px">
              <button class="btn btnPrimary" onclick="nextStep()">Pr√≥ximo ‚ûú</button>
              <button class="btn btnGhost" onclick="openCart()">Ver carrinho</button>
            </div>
          </div>

          <div id="step2" class="hide">
            <div class="card" style="background:rgba(255,255,255,.05); border-color:rgba(255,255,255,.08)">
              <div class="cardBd">
                <b>Revis√£o</b>
                <div class="mini" id="reviewTxt" style="margin-top:6px"></div>
              </div>
            </div>
            <div class="row" style="margin-top:12px">
              <button class="btn btnGhost" onclick="prevStep()">‚óÄ Voltar</button>
              <button class="btn btnPrimary" onclick="createOrder()">Gerar pedido + PIX</button>
            </div>
          </div>

          <div id="step3" class="hide">
            <div class="card" style="background:rgba(255,255,255,.05); border-color:rgba(255,255,255,.08)">
              <div class="cardBd">
                <div class="row" style="justify-content:space-between">
                  <b>PIX</b>
                  <span class="mini" id="pixTotal"></span>
                </div>
                <div class="mini" style="margin-top:8px">Copie o c√≥digo PIX e pague no seu banco. Depois, envie o comprovante no WhatsApp.</div>
                <textarea class="inp" id="pixCode" rows="4" style="margin-top:10px; resize:none"></textarea>
                <div class="row" style="margin-top:10px">
                  <button class="btn btnPrimary" onclick="copyPix()">üìã Copiar PIX</button>
                  <button class="btn btnGhost" onclick="sendWppProof()">üí¨ Enviar comprovante</button>
                </div>
                <div class="mini" id="orderIdBox" style="margin-top:10px"></div>
              </div>
            </div>
            <div class="row" style="margin-top:12px">
              <button class="btn btnGhost" onclick="resetCheckout()">Novo pedido</button>
              <button class="btn btnGhost" onclick="go('pedido')">Acompanhar pedido</button>
            </div>
          </div>
        </div>
      </section>
    </div>

    <section class="card" id="pedido" style="margin-top:14px">
      <div class="cardHd">
        <h2><span data-i18n="order_status_title">Status do pedido</span> (Order ID)</h2>
        <p>Verifique se √© oficial e veja o andamento.</p>
      </div>
      <div class="cardBd">
        <div class="row">
          <div style="flex:1; min-width:220px">
            <label>Cole o Order ID</label>
            <input class="inp" id="orderIdInput" placeholder="Ex: VV-2026-..." />
          </div>
          <div style="display:flex; gap:10px; align-items:flex-end">
            <button class="btn btnPrimary" onclick="checkOrder()">üîé Verificar</button>
          </div>
        </div>

        <div class="card" style="margin-top:12px; background:rgba(255,255,255,.05); border-color:rgba(255,255,255,.08)">
          <div class="cardBd" id="orderOut">
            <span class="mini">Cole um Order ID e toque em Verificar.</span>
          </div>
        </div>
      </div>
    </section>

    <section class="card" id="faq" style="margin-top:14px">
      <div class="cardHd">
        <h2>FAQ</h2>
        <p>R√°pido e direto.</p>
      </div>
      <div class="cardBd">
        <details>
          <summary><b>Como sei que √© oficial?</b></summary>
          <div class="mini">Sempre gere seu pedido aqui. Depois, use o Order ID para verificar status. Se o site n√£o confirmar, n√£o pague.</div>
        </details>
        <details style="margin-top:10px">
          <summary><b>Quanto tempo para entrega?</b></summary>
          <div class="mini">Depende do item, mas a meta √© entregar o mais r√°pido poss√≠vel. O status mostra: Criado ‚Üí Pago ‚Üí Entregue.</div>
        </details>
        <details style="margin-top:10px">
          <summary><b>Suporte</b></summary>
          <div class="mini">Use o bot√£o do WhatsApp. Envie seu Order ID e o comprovante.</div>
        </details>
      </div>
    </section>
  </div>

  <!-- WhatsApp Float -->
  <div id="wppFloat">
    <button onclick="openWpp()">üí¨ WhatsApp</button>
  </div>

  <!-- Bottom Nav -->
  <div id="bottomNav">
    <div class="bar">
      <button class="navBtn on" id="nCat" onclick="go('catalogo')">üõçÔ∏è<div>Cat√°logo</div></button>
      <button class="navBtn" id="nChk" onclick="go('checkout')">üßæ<div>Checkout</div></button>
      <button class="navBtn" id="nPed" onclick="go('pedido')">üì¶<div>Pedido</div></button>
      <button class="navBtn" id="nFaq" onclick="go('faq')">‚ùì<div>FAQ</div></button>
    </div>
  </div>

  <!-- Cart overlay/drawer -->
  <div class="overlay" id="ov" onclick="closeCart()"></div>
  <aside class="drawer" id="drawer" aria-label="Carrinho">
    <div class="drawerTop">
      <div>
        <b style="font-size:16px">Carrinho</b>
        <div class="mini" id="cartMini"></div>
      </div>
      <button class="x" onclick="closeCart()">‚úï</button>
    </div>

    <div class="cartList" id="cartList"></div>

    <div class="sum">
      <div class="sumRow">
        <b>Total</b>
        <b id="cartTotal">R$ 0,00</b>
      </div>
      <div class="row" style="margin-top:10px">
        <button class="btn btnPrimary" style="flex:1; justify-content:center" onclick="go('checkout'); closeCart(); toast('Checkout aberto ‚úÖ')">Finalizar</button>
        <button class="btn btnGhost" onclick="clearCart()">Limpar</button>
      </div>
    </div>
  </aside>

  <div id="toast"></div>

  <script>
    const WORKER = 'https://viralvault-sign.darlanana06.workers.dev';
    // Configs
    const WPP_NUMBER = "5511941598713";
    const CATALOG_ENDPOINTS = [
      WORKER + "/catalog",
      WORKER + "/catalog.json",
      WORKER + "/products",
      WORKER + "/produtos"
    ];

    // State
    let catalog = [];
    let categories = [];
    let activeCat = "Todos";
    let cart = load("vv_cart", []);
    let currentOrder = null;
    let step = 1;

    // Helpers
    const money = (n)=> "R$ " + (Number(n||0)).toFixed(2).replace(".", ",");
    function save(k,v){ localStorage.setItem(k, JSON.stringify(v)); }
    function load(k, d){ try{ return JSON.parse(localStorage.getItem(k) || "null") ?? d; }catch(e){ return d; } }
    function toast(msg){ const t=document.getElementById("toast"); t.textContent=msg; t.style.display="block"; clearTimeout(window.__tt); window.__tt=setTimeout(()=>t.style.display="none", 2200); }

    function setNav(id){
      ["nCat","nChk","nPed","nFaq"].forEach(x=>document.getElementById(x).classList.remove("on"));
      const map={catalogo:"nCat", checkout:"nChk", pedido:"nPed", faq:"nFaq", home:"nCat"};
      const key = map[id] || "nCat";
      document.getElementById(key).classList.add("on");
    }

    function go(id){
      const el = document.getElementById(id);
      if(!el) return;
      setNav(id);
      el.scrollIntoView({behavior:"smooth", block:"start"});
    }

    // Search
    const q = document.getElementById("q");
    if(q){
      q.addEventListener("input", ()=> renderProducts());
    }

    // Catalog fetch (worker) with fallback
    const fallbackCatalog = [
      {id:"robux_100", name:"Robux 100", category:"Robux", price:4.80, tag:"Robux"},
      {id:"robux_500", name:"Robux 500", category:"Robux", price:19.90, tag:"Robux"},
      {id:"conta_dragon", name:"Conta Dragon", category:"Conta", price:49.90, tag:"Conta"},
      {id:"item_raro", name:"Item Raro", category:"Itens", price:9.60, tag:"Itens"}
    ];

    async function loadCatalog(){
      document.getElementById("catHint").textContent = "Carregando‚Ä¶";
      let data = null;
      let used = "";
      for(const url of CATALOG_ENDPOINTS){
        try{
          const r = await fetch(url, {cache:"no-store"});
          if(!r.ok) continue;
          data = await r.json();
          used = url;
          break;
        }catch(e){}
      }

      // Normalize
      if(!data){
        catalog = fallbackCatalog;
        document.getElementById("catSource").textContent = "Cat√°logo: modo fallback (offline).";
      } else {
        // Accept formats: array; {items:[]}; {products:[]}
        const arr = Array.isArray(data) ? data : (data.items || data.products || data.catalog || []);
        catalog = arr.map((p, idx)=> ({
          id: String(p.id || p.sku || p.code || idx),
          name: String(p.name || p.title || p.produto || "Produto"),
          category: String(p.category || p.categoria || p.type || "Outros"),
          price: Number(p.price || p.valor || p.amount || 0),
          tag: String(p.tag || p.badge || p.category || "ViralVault")
        })).filter(x=>x.name);
        document.getElementById("catSource").textContent = "Cat√°logo: online (" + used.replace(WORKER,"") + ")";
      }

      categories = ["Todos", ...Array.from(new Set(catalog.map(p=>p.category)))];
      renderCats();
      renderProducts();
      updateCartUI();
      document.getElementById("catHint").textContent = categories.length + " categorias";
    }

    function renderCats(){
      const c = document.getElementById("cats");
      c.innerHTML = "";
      categories.forEach(cat=>{
        const b = document.createElement("div");
        b.className = "chip" + (cat===activeCat ? " active":"");
        b.textContent = cat;
        b.onclick = ()=>{ activeCat = cat; renderCats(); renderProducts(); };
        c.appendChild(b);
      });
    }

    function renderProducts(){
      const list = document.getElementById("products");
      const query = (document.getElementById("q")?.value || "").toLowerCase().trim();
      let items = catalog.slice();
      if(activeCat !== "Todos") items = items.filter(p=>p.category===activeCat);
      if(query) items = items.filter(p=> (p.name + " " + p.category + " " + (p.tag||"")).toLowerCase().includes(query));

      document.getElementById("pCount").textContent = items.length + " itens";
      list.innerHTML = "";
      items.forEach(p=>{
        const card = document.createElement("div");
        card.className = "p";
        card.innerHTML = `
          <div class="pImg"><span class="tag">${escapeHtml(p.tag || p.category)}</span></div>
          <div class="pBody">
            <div class="pName">${escapeHtml(p.name)}</div>
            <div class="pMeta">
              <div class="price">${money(p.price)}</div>
              <div class="muted">Toque para adicionar</div>
            </div>
          </div>`;
        card.onclick = ()=> addToCart(p.id);
        list.appendChild(card);
      });
    }

    function escapeHtml(s){ return String(s||"").replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"}[m])); }

    // Cart
    function openCart(){ document.getElementById("ov").classList.add("show"); document.getElementById("drawer").classList.add("open"); }
    function closeCart(){ document.getElementById("ov").classList.remove("show"); document.getElementById("drawer").classList.remove("open"); }
    function clearCart(){ cart = []; save("vv_cart", cart); updateCartUI(); toast("Carrinho limpo"); }

    function addToCart(id){
      const p = catalog.find(x=>x.id===id);
      if(!p) return;
      const it = cart.find(x=>x.id===id);
      if(it) it.qty += 1;
      else cart.push({id, qty:1});
      save("vv_cart", cart);
      updateCartUI();
      toast("Adicionado ‚úÖ");
    }
    function dec(id){ const it=cart.find(x=>x.id===id); if(!it) return; it.qty-=1; if(it.qty<=0) cart=cart.filter(x=>x.id!==id); save("vv_cart",cart); updateCartUI(); }
    function inc(id){ const it=cart.find(x=>x.id===id); if(!it) return; it.qty+=1; save("vv_cart",cart); updateCartUI(); }

    function cartTotal(){
      return cart.reduce((sum, it)=>{
        const p=catalog.find(x=>x.id===it.id);
        return sum + (p? p.price*it.qty : 0);
      },0);
    }

    function updateCartUI(){
      const badge = document.getElementById("cartBadge");
      const count = cart.reduce((a,x)=>a+x.qty,0);
      badge.style.display = count? "grid":"none";
      badge.textContent = String(count);

      document.getElementById("cartMini").textContent = count ? (count + " item(ns)") : "Vazio";
      document.getElementById("cartTotal").textContent = money(cartTotal());

      const list = document.getElementById("cartList");
      list.innerHTML = "";
      if(!cart.length){
        list.innerHTML = `<div class="mini">Seu carrinho est√° vazio. Toque em um produto no cat√°logo para adicionar.</div>`;
        return;
      }
      cart.forEach(it=>{
        const p = catalog.find(x=>x.id===it.id) || {name:"Produto", price:0};
        const row = document.createElement("div");
        row.className = "cartItem";
        row.innerHTML = `
          <div class="ciBox"></div>
          <div class="ciInfo">
            <b>${escapeHtml(p.name)}</b>
            <div class="mini">${money(p.price)} ‚Ä¢ ${escapeHtml(p.category||"")}</div>
            <div class="qty" style="margin-top:8px">
              <button class="qbtn" onclick="dec('${it.id}')">‚àí</button>
              <b>${it.qty}</b>
              <button class="qbtn" onclick="inc('${it.id}')">+</button>
            </div>
          </div>`;
        list.appendChild(row);
      });
    }

    // Checkout steps
    function setStep(n){
      step = n;
      document.getElementById("step1").classList.toggle("hide", n!==1);
      document.getElementById("step2").classList.toggle("hide", n!==2);
      document.getElementById("step3").classList.toggle("hide", n!==3);
      document.getElementById("s1").classList.toggle("on", n===1);
      document.getElementById("s2").classList.toggle("on", n===2);
      document.getElementById("s3").classList.toggle("on", n===3);
    }

    function validUser(u){
      return /^[A-Za-z0-9_](3, 20)$/.test(u);
    }

    function nextStep(){
      if(!cart.length){ toast("Adicione itens no carrinho primeiro"); go("catalogo"); return; }
      const u = document.getElementById("robloxUser").value.trim();
      if(!validUser(u)){ toast("User inv√°lido. Ex: Darlan0786"); return; }
      const lines = cart.map(it=>{
        const p=catalog.find(x=>x.id===it.id);
        return `‚Ä¢ ${it.qty}x ${p? p.name : it.id}`;
      }).join("\n");
      document.getElementById("reviewTxt").textContent = `User: ${u}\n\nItens:\n${lines}\n\nTotal: ${money(cartTotal())}`;
      setStep(2);
      go("checkout");
    }
    function prevStep(){ setStep(1); }
    function resetCheckout(){ currentOrder=null; document.getElementById("pixCode").value=""; document.getElementById("orderIdBox").textContent=""; setStep(1); }

    // Create order via Worker
    async function createOrder(){
      const u = document.getElementById("robloxUser").value.trim();
      if(!validUser(u)){ toast("User inv√°lido"); setStep(1); return; }
      const items = cart.map(it=>{
        const p=catalog.find(x=>x.id===it.id) || {};
        return {
          id: it.id,
          name: p.name || it.id,
          category: p.category || "Outros",
          qty: it.qty,
          price: Number(p.price||0)
        };
      });
      const payload = { user: u, items, total: cartTotal(), source: "site-index" };

      toast("Gerando pedido‚Ä¶");
      try{
        const r = await fetch(WORKER + "/create-order", {
          method:"POST",
          headers:{"content-type":"application/json"},
          body: JSON.stringify(payload)
        });
        const data = await r.json().catch(()=>null);
        if(!r.ok || !data) throw new Error(data?.error || "Falha");
        currentOrder = data;
        const orderId = data.orderId || data.id || data.order_id;
        const pix = data.pix || data.pixCode || data.pix_code || data.qr || data.payload;
        document.getElementById("pixCode").value = pix || "";
        document.getElementById("pixTotal").textContent = money(cartTotal());
        document.getElementById("orderIdBox").innerHTML = "<b>Order ID:</b> " + escapeHtml(orderId || "(n√£o retornado)") + " ‚Ä¢ <span class='mini'>Use no <span data-i18n="order_status_title">Status do pedido</span></span>";
        setStep(3);
        toast("Pedido criado ‚úÖ");
        if(orderId){ document.getElementById("orderIdInput").value = orderId; }
      }catch(e){
        console.error(e);
        toast("Erro ao gerar pedido. Tente novamente.");
      }
    }

    async function copyPix(){
      const v = document.getElementById("pixCode").value.trim();
      if(!v){ toast("PIX vazio"); return; }
      try{ await navigator.clipboard.writeText(v); toast("PIX copiado ‚úÖ"); }
      catch(e){ document.getElementById("pixCode").select(); document.execCommand("copy"); toast("PIX copiado ‚úÖ"); }
    }

    function openWpp(){
      const msg = encodeURIComponent("Ol√°! Vim pelo site ViralVault. Preciso de ajuda üôÇ");
      window.open(`https://wa.me/${WPP_NUMBER}?text=${msg}`, "_blank");
    }

    function sendWppProof(){
      const u = document.getElementById("robloxUser").value.trim();
      const orderId = (currentOrder?.orderId || currentOrder?.id || currentOrder?.order_id || document.getElementById("orderIdInput").value.trim() || "").trim();
      const total = money(cartTotal());
      const items = cart.map(it=>{
        const p=catalog.find(x=>x.id===it.id);
        return `${it.qty}x ${p? p.name : it.id}`;
      }).join(", ");
      const msg = encodeURIComponent(
        `‚úÖ Comprovante/Status\n`+
        `User: ${u}\n`+
        `Order ID: ${orderId}\n`+
        `Itens: ${items}\n`+
        `Total: ${total}\n\n`+
        `Vou enviar o comprovante agora.`
      );
      window.open(`https://wa.me/${WPP_NUMBER}?text=${msg}`, "_blank");
    }

    // Order status
    async function checkOrder(){
      const id = document.getElementById("orderIdInput").value.trim();
      if(!id){ toast("Cole um Order ID"); return; }
      const out = document.getElementById("orderOut");
      out.innerHTML = "<span class='mini'>Consultando‚Ä¶</span>";
      try{
        const r = await fetch(WORKER + "/order-status?orderId=" + encodeURIComponent(id), {cache:"no-store"});
        const data = await r.json().catch(()=>null);
        if(!r.ok || !data) throw new Error(data?.error || "Falha");
        const status = String(data.status || data.state || "desconhecido").toLowerCase();
        const map = {
          created: ["Criado", "üßæ"],
          pending: ["Pendente", "‚è≥"],
          paid: ["Pago", "‚úÖ"],
          delivered: ["Entregue", "üì¶"],
          canceled: ["Cancelado", "üõë"],
        };
        const key = (map[status] ? status : (status.includes("paid")?"paid": status.includes("deliver")?"delivered": status.includes("cancel")?"canceled": status.includes("pend")?"pending":"created"));
        const label = map[key][0];
        const emoji = map[key][1];
        const user = data.user || data.username || "-";
        const total = money(data.total || data.amount || cartTotal());
        out.innerHTML = `
          <div class="row" style="justify-content:space-between; align-items:flex-start">
            <div>
              <b style="font-size:16px">${emoji} ${label}</b>
              <div class="mini">Order ID: ${escapeHtml(id)} ‚Ä¢ User: ${escapeHtml(user)}</div>
            </div>
            <div style="text-align:right">
              <b>${total}</b>
              <div class="mini">Total</div>
            </div>
          </div>
          <div class="card" style="margin-top:12px; background:rgba(255,255,255,.05); border-color:rgba(255,255,255,.08)">
            <div class="cardBd">
              <b>Timeline</b>
              <div class="mini" style="margin-top:6px">üßæ Criado ‚Üí ‚úÖ Pago ‚Üí üì¶ Entregue</div>
              <div class="mini" style="margin-top:10px">${escapeHtml(data.note || data.message || "")}</div>
            </div>
          </div>
          <div class="row" style="margin-top:12px">
            <button class="btn btnPrimary" onclick="sendWppFromOrder('${escapeHtml(id)}')">üí¨ Falar no WhatsApp</button>
            <button class="btn btnGhost" onclick="toast('Dica: envie o comprovante no WhatsApp com o Order ID')">‚ÑπÔ∏è Dica</button>
          </div>
        `;
      }catch(e){
        console.error(e);
        out.innerHTML = "<span class='mini'>N√£o consegui consultar. Verifique o Order ID ou tente de novo.</span>";
      }
    }

    function sendWppFromOrder(orderId){
      const msg = encodeURIComponent(`Ol√°! Quero suporte. Meu Order ID √©: ${orderId}`);
      window.open(`https://wa.me/${WPP_NUMBER}?text=${msg}`, "_blank");
    }

    // Init
    (function(){
      loadCatalog();
      updateCartUI();
      setStep(1);
      // keyboard shortcuts basic
      document.addEventListener("keydown", (e)=>{
        if(e.key==="k" && (e.ctrlKey||e.metaKey)){ e.preventDefault(); go("catalogo"); }
        if(e.key==="c" && (e.ctrlKey||e.metaKey)){ e.preventDefault(); go("checkout"); }
        if(e.key==="p" && (e.ctrlKey||e.metaKey)){ e.preventDefault(); go("pedido"); }
      });
    })();
  </script>

<script>
/* ===== Drawer + i18n ===== */
(function(){
  const $ = (s, r=document)=>r.querySelector(s);
  const $$ = (s, r=document)=>Array.from(r.querySelectorAll(s));

  const overlay = $("#vvMenuOverlay");
  const drawer = $("#vvDrawer");
  const openBtn = $("#vvMenuBtn");
  const closeBtn = $("#vvDrawerClose");

  function openDrawer(){
    overlay.classList.add("open");
    drawer.classList.add("open");
    overlay.setAttribute("aria-hidden","false");
    document.body.style.overflow = "hidden";
  }
  function closeDrawer(){
    overlay.classList.remove("open");
    drawer.classList.remove("open");
    overlay.setAttribute("aria-hidden","true");
    document.body.style.overflow = "";
  }
  if(openBtn) openBtn.addEventListener("click", openDrawer);
  if(closeBtn) closeBtn.addEventListener("click", closeDrawer);
  if(overlay) overlay.addEventListener("click", closeDrawer);
  document.addEventListener("keydown",(e)=>{ if(e.key==="Escape"){ closeDrawer(); closeLang(); } });

  // Drawer actions
  $$(".vvDrawerItem").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const go = btn.getAttribute("data-go");
      if(go){
        // Try to use existing navigation if present
        const map = {
          catalog: "#catalog",
          cart: "#catalog",
          orders: "#order",
          support: "#support",
          profile: "#profile"
        };
        const target = map[go] || "#";
        if(target && target !== "#"){
          location.hash = target;
          window.scrollTo({top: 0, behavior:"smooth"});
        }
      }
      closeDrawer();
    });
  });

  // Social buttons (safe defaults)
  const ig = $("#vvSocIG"); const dc = $("#vvSocDC");
  if(ig) ig.addEventListener("click", ()=>{ window.open("https://instagram.com", "_blank"); });
  if(dc) dc.addEventListener("click", ()=>{ window.open("https://discord.com", "_blank"); });

  // Logout demo (doesn't break)
  const lo = $("#vvLogoutBtn");
  if(lo) lo.addEventListener("click", ()=>{
    try{ localStorage.removeItem("vv_user"); }catch(_){}
    closeDrawer();
    alert(t("logout_msg"));
  });

  // ===== Language modal =====
  const langOverlay = $("#vvLangOverlay");
  const langModal = $("#vvLangModal");
  const langBtn = $("#vvLangBtn");
  const langClose = $("#vvLangClose");
  const openLangFromDrawer = $("#vvOpenLang");

  function openLang(){
    if(!langOverlay || !langModal) return;
    langOverlay.classList.add("open");
    langModal.classList.add("open");
    langOverlay.setAttribute("aria-hidden","false");
  }
  function closeLang(){
    if(!langOverlay || !langModal) return;
    langOverlay.classList.remove("open");
    langModal.classList.remove("open");
    langOverlay.setAttribute("aria-hidden","true");
  }
  if(langBtn) langBtn.addEventListener("click", openLang);
  if(openLangFromDrawer) openLangFromDrawer.addEventListener("click", ()=>{ closeDrawer(); openLang(); });
  if(langClose) langClose.addEventListener("click", closeLang);
  if(langOverlay) langOverlay.addEventListener("click", closeLang);

  // ===== i18n dictionary =====
  const dict = {
    "pt-BR": {
      brand_name: "ViralVault Store",
      menu_title: "Menu",
      menu_catalog: "Cat√°logos",
      menu_support: "Suporte",
      menu_cart: "Carrinho",
      menu_orders: "Minhas Compras",
      menu_profile: "Meu Perfil",
      menu_exit: "Sair",
      menu_social: "Redes Sociais",
      menu_account: "Conta",
      menu_language: "Idioma",
      menu_profile_sub: "Loja digital ‚Ä¢ PIX ‚Ä¢ verifica√ß√£o",
      lang_title: "Escolha o idioma",
      lang_pt: "Padr√£o",
      lang_en: "Internacional",
      lang_es: "LatAm",
      cta_catalog: "Ver cat√°logo",
      cta_checkout: "Ir pro checkout",
      cta_order: "Ver pedido",
      order_status_title: "Status do pedido",
      order_id_placeholder: "Cole o Order ID aqui",
      logout_msg: "Saiu (modo demo)."
    },
    "en": {
      brand_name: "ViralVault Store",
      menu_title: "Menu",
      menu_catalog: "Catalogs",
      menu_support: "Support",
      menu_cart: "Cart",
      menu_orders: "My Orders",
      menu_profile: "My Profile",
      menu_exit: "Exit",
      menu_social: "Social",
      menu_account: "Account",
      menu_language: "Language",
      menu_profile_sub: "Digital store ‚Ä¢ PIX ‚Ä¢ verification",
      lang_title: "Choose language",
      lang_pt: "Default",
      lang_en: "International",
      lang_es: "LatAm",
      cta_catalog: "View catalog",
      cta_checkout: "Go to checkout",
      cta_order: "Track order",
      order_status_title: "Order status",
      order_id_placeholder: "Paste your Order ID here",
      logout_msg: "Signed out (demo)."
    },
    "es": {
      brand_name: "ViralVault Store",
      menu_title: "Men√∫",
      menu_catalog: "Cat√°logos",
      menu_support: "Soporte",
      menu_cart: "Carrito",
      menu_orders: "Mis compras",
      menu_profile: "Mi perfil",
      menu_exit: "Salir",
      menu_social: "Redes",
      menu_account: "Cuenta",
      menu_language: "Idioma",
      menu_profile_sub: "Tienda digital ‚Ä¢ PIX ‚Ä¢ verificaci√≥n",
      lang_title: "Elige el idioma",
      lang_pt: "Predeterminado",
      lang_en: "Internacional",
      lang_es: "LatAm",
      cta_catalog: "Ver cat√°logo",
      cta_checkout: "Ir al checkout",
      cta_order: "Ver pedido",
      order_status_title: "Estado del pedido",
      order_id_placeholder: "Pega el Order ID aqu√≠",
      logout_msg: "Sesi√≥n cerrada (demo)."
    }
  };

  function getLang(){
    try{ return localStorage.getItem("vv_lang") || "pt-BR"; }catch(_){ return "pt-BR"; }
  }
  function setLang(l){
    try{ localStorage.setItem("vv_lang", l); }catch(_){}
    applyLang(l);
  }
  function t(key){
    const l = getLang();
    return (dict[l] && dict[l][key]) || (dict["pt-BR"][key]) || key;
  }
  window.vvT = t;

  function applyLang(l){
    const d = dict[l] || dict["pt-BR"];
    $$("[data-i18n]").forEach(el=>{
      const k = el.getAttribute("data-i18n");
      if(d[k]) el.textContent = d[k];
    });
    // placeholders
    $$("[data-i18n-ph]").forEach(el=>{
      const k = el.getAttribute("data-i18n-ph");
      if(d[k]) el.setAttribute("placeholder", d[k]);
    });
    // active state in modal
    $$(".vvLangCard").forEach(card=>{
      card.classList.toggle("active", card.getAttribute("data-lang")===l);
    });
  }

  // hook language cards
  $$(".vvLangCard").forEach(card=>{
    card.addEventListener("click", ()=>{
      setLang(card.getAttribute("data-lang"));
      closeLang();
    });
  });

  // initialize
  applyLang(getLang());

})();
</script>


<script>
/* ===== Purchases (Minhas Compras) ===== */
const VV_PURCHASES_KEY = "VV_PURCHASES_V1";

function vvLoadPurchases(){
  try{ return JSON.parse(localStorage.getItem(VV_PURCHASES_KEY) || "[]"); }catch(e){ return []; }
}
function vvSavePurchases(list){
  localStorage.setItem(VV_PURCHASES_KEY, JSON.stringify(list||[]));
}
function vvUpsertPurchase(p){
  const list = vvLoadPurchases();
  const id = (p && p.orderId) ? String(p.orderId) : "";
  if(!id) return list;
  const idx = list.findIndex(x => String(x.orderId) === id);
  const now = Date.now();
  const base = { orderId:id, createdAt: p.createdAt||now, updatedAt: now, status:p.status||"created", username:p.username||"", total:p.total||null, items:p.items||[] };
  if(idx >= 0){
    list[idx] = { ...list[idx], ...base, createdAt: list[idx].createdAt || base.createdAt };
  }else{
    list.unshift(base);
  }
  vvSavePurchases(list);
  return list;
}
function vvRemovePurchase(orderId){
  const id = String(orderId||"");
  const list = vvLoadPurchases().filter(x => String(x.orderId) !== id);
  vvSavePurchases(list);
  return list;
}

function vvFmtDate(ts){
  try{
    const d = new Date(ts);
    return d.toLocaleString(undefined, {year:"numeric", month:"2-digit", day:"2-digit", hour:"2-digit", minute:"2-digit"});
  }catch(e){ return ""; }
}

async function vvVerifyOrderWorker(orderId){
  // Uses the configured WORKER_BASE (same one used in verification area)
  const base = (window.VV_WORKER_BASE || "").replace(/\/+$/,"");
  if(!base) throw new Error("Worker base not configured");
  const url = base + "/verify";
  const res = await fetch(url, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({ orderId })
  });
  const data = await res.json().catch(()=> ({}));
  if(!res.ok) throw new Error(data.error || "verify failed");
  return data; // expected: {ok:true, official:true/false, status:"paid"/"delivered"/... , ...}
}

function vvStatusPill(status, official){
  const s = String(status||"").toLowerCase();
  const map = {
    created:{t:"Criado", i:"üßæ"},
    pending:{t:"Pendente", i:"‚è≥"},
    paid:{t:"Pago", i:"‚úÖ"},
    delivered:{t:"Entregue", i:"üì¶"},
    cancelled:{t:"Cancelado", i:"‚úñÔ∏è"},
    unknown:{t:"Desconhecido", i:"‚ùî"}
  };
  const k = map[s] ? s : "unknown";
  const txt = map[k].i + " " + map[k].t + (official ? " ‚Ä¢ Oficial" : "");
  return txt;
}

async function vvRenderPurchases({refresh=false}={}){
  const listEl = document.getElementById("purchasesList");
  const emptyEl = document.getElementById("purchasesEmpty");
  if(!listEl || !emptyEl) return;

  let list = vvLoadPurchases();
  emptyEl.hidden = list.length !== 0;
  listEl.innerHTML = "";

  // optional refresh via worker
  if(refresh && list.length){
    for(const p of list){
      try{
        const v = await vvVerifyOrderWorker(p.orderId);
        // normalize
        const nextStatus = (v.status || v.state || (v.paid? "paid":"") || p.status || "unknown");
        vvUpsertPurchase({ orderId:p.orderId, status: nextStatus, updatedAt: Date.now(), official: !!v.official, verify: v });
      }catch(e){
        // keep existing
      }
    }
    list = vvLoadPurchases();
  }

  emptyEl.hidden = list.length !== 0;
  for(const p of list){
    const row = document.createElement("div");
    row.className = "vvListItem";

    const left = document.createElement("div");
    left.className = "vvListMain";

    const title = document.createElement("div");
    title.className = "vvListTitle";
    title.textContent = p.orderId;

    const meta = document.createElement("div");
    meta.className = "vvListMeta";
    const official = !!(p.verify && p.verify.official) || !!p.official;
    meta.textContent = `${vvStatusPill(p.status, official)} ‚Ä¢ ${vvFmtDate(p.createdAt||p.updatedAt||Date.now())}`;

    left.appendChild(title);
    left.appendChild(meta);

    const actions = document.createElement("div");
    actions.className = "vvListActions";

    const btnSee = document.createElement("button");
    btnSee.className = "vvBtn vvBtnGhost";
    btnSee.innerHTML = '<span class="vvI">üîé</span><span data-i18n="purchases_view">Ver</span>';
    btnSee.addEventListener("click", ()=>{
      // go to order view, fill id and trigger verify
      if(window.vvNavigate) window.vvNavigate("order");
      const inp = document.getElementById("orderIdInput") || document.querySelector('[name="orderId"]') || document.getElementById("orderId");
      if(inp) inp.value = p.orderId;
      const b = document.getElementById("btnVerifyOrder") || document.querySelector('[data-action="verify-order"]');
      if(b) b.click();
    });

    const btnWpp = document.createElement("button");
    btnWpp.className = "vvBtn vvBtnGhost";
    btnWpp.innerHTML = '<span class="vvI">üí¨</span><span data-i18n="purchases_whatsapp">WhatsApp</span>';
    btnWpp.addEventListener("click", ()=>{
      const wpp = (window.VV_WPP_NUMBER || "").replace(/\D/g,"");
      const msg = `Ol√°! Quero ajuda com meu pedido.\nOrder ID: ${p.orderId}\nStatus: ${p.status||"?"}`;
      if(wpp){
        window.open(`https://wa.me/${wpp}?text=${encodeURIComponent(msg)}`, "_blank");
      }
    });

    const btnDel = document.createElement("button");
    btnDel.className = "vvBtn vvBtnDanger vvBtnGhost";
    btnDel.innerHTML = '<span class="vvI">üóëÔ∏è</span><span data-i18n="purchases_remove">Remover</span>';
    btnDel.addEventListener("click", ()=>{
      vvRemovePurchase(p.orderId);
      vvRenderPurchases();
      if(window.vvApplyI18n) window.vvApplyI18n(); // re-apply texts
    });

    actions.appendChild(btnSee);
    actions.appendChild(btnWpp);
    actions.appendChild(btnDel);

    row.appendChild(left);
    row.appendChild(actions);

    listEl.appendChild(row);
  }

  if(window.vvApplyI18n) window.vvApplyI18n();
}

document.addEventListener("click", (e)=>{
  const t = e.target.closest && e.target.closest("#btnPurchRefresh");
  if(t){ vvRenderPurchases({refresh:true}); }
});

document.addEventListener("click", (e)=>{
  const t = e.target.closest && e.target.closest("#btnPurchAdd");
  if(!t) return;
  const inp = document.getElementById("purchasesAddId");
  const id = inp ? inp.value.trim() : "";
  if(!id) return;
  vvUpsertPurchase({orderId:id, status:"unknown"});
  if(inp) inp.value = "";
  vvRenderPurchases({refresh:true});
});

document.addEventListener("click", (e)=>{
  const t = e.target.closest && e.target.closest("#btnPurchClear");
  if(!t) return;
  vvSavePurchases([]);
  vvRenderPurchases();
});

document.addEventListener("click", (e)=>{
  const t = e.target.closest && e.target.closest("#btnPurchExport");
  if(!t) return;
  const data = vvLoadPurchases();
  const blob = new Blob([JSON.stringify(data,null,2)], {type:"application/json"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "viralvault_pedidos.json";
  document.body.appendChild(a);
  a.click();
  a.remove();
});

document.addEventListener("click", (e)=>{
  const t = e.target.closest && e.target.closest("#btnPurchImport");
  if(!t) return;
  const f = document.getElementById("purchasesFile");
  if(f) f.click();
});
document.addEventListener("change", (e)=>{
  const f = e.target;
  if(!f || f.id !== "purchasesFile" || !f.files || !f.files[0]) return;
  const file = f.files[0];
  const r = new FileReader();
  r.onload = ()=>{
    try{
      const arr = JSON.parse(String(r.result||"[]"));
      if(Array.isArray(arr)){
        // merge
        let list = vvLoadPurchases();
        for(const p of arr){
          if(p && p.orderId) vvUpsertPurchase(p);
        }
        vvRenderPurchases();
      }
    }catch(err){}
  };
  r.readAsText(file);
  f.value = "";
});

// Hook: when a new order is generated in checkout flow, call vvUpsertPurchase
window.vvRememberOrder = function(order){
  try{ vvUpsertPurchase(order); }catch(e){}
};
window.vvRenderPurchases = vvRenderPurchases;
</script>

</body>
</html>
