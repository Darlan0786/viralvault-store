<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <meta name="theme-color" content="#0b0f1a"/>
  <meta name="color-scheme" content="dark light"/>
  <meta name="description" content="ViralVault — loja de itens/serviços para Roblox com checkout PIX, verificação de pedido e anti-golpe via Order ID."/>
  <meta name="robots" content="index,follow,max-image-preview:large"/>
  <link rel="canonical" href="https://viralvault-store.vercel.app/"/>

  <meta property="og:type" content="website"/>
  <meta property="og:title" content="ViralVault Store"/>
  <meta property="og:description" content="Checkout PIX, verificação por Order ID e histórico de compras."/>
  <meta property="og:url" content="https://viralvault-store.vercel.app/"/>
  <meta property="og:site_name" content="ViralVault"/>

  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="ViralVault Store"/>
  <meta name="twitter:description" content="Checkout PIX, verificação por Order ID e histórico de compras."/>

  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <title>ViralVault Store</title>

  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebSite",
    "name":"ViralVault Store",
    "url":"https://viralvault-store.vercel.app/",
    "potentialAction":{
      "@type":"SearchAction",
      "target":"https://viralvault-store.vercel.app/?q={search_term_string}",
      "query-input":"required name=search_term_string"
    }
  }
  </script>

  <style>
    :root{
      --bg:#070a12;
      --panel: rgba(255,255,255,.06);
      --stroke: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.68);
      --muted2: rgba(255,255,255,.52);
      --brand: #7c6cff;
      --brand2:#4dd3ff;
      --ok:#3ddc97;
      --bad:#ff5a6a;
      --shadow: 0 16px 50px rgba(0,0,0,.55);
      --r22:22px;
      --r28:28px;
      --max:1100px;
      --tap: 44px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(900px 600px at 20% 10%, rgba(124,108,255,.28), transparent 60%),
        radial-gradient(900px 600px at 85% 30%, rgba(77,211,255,.18), transparent 55%),
        radial-gradient(900px 800px at 50% 120%, rgba(61,220,151,.12), transparent 60%),
        var(--bg);
      overflow-x:hidden;
    }
    .wrap{max-width:var(--max); margin:0 auto; padding: 18px 16px 96px;}
    .topbar{
      position:sticky; top:0; z-index:20;
      backdrop-filter: blur(14px);
      background: linear-gradient(to bottom, rgba(7,10,18,.82), rgba(7,10,18,.45));
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .topbar .inner{
      max-width:var(--max); margin:0 auto; padding: 12px 16px;
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .brand{display:flex; align-items:center; gap:10px; min-width:0;}
    .logo{
      width:42px; height:42px; border-radius: 14px;
      background: linear-gradient(135deg, var(--brand), var(--brand2));
      box-shadow: 0 10px 30px rgba(124,108,255,.25);
      display:grid; place-items:center;
      font-weight:900;
      letter-spacing:.5px;
      color:#0b0f1a;
    }
    .brand .t{display:flex; flex-direction:column; min-width:0}
    .brand .t b{font-size:14px; line-height:1.1}
    .brand .t span{font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .actions{display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:flex-end}
    .btn{
      appearance:none; border:1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      color:var(--text);
      height: var(--tap);
      padding: 0 14px;
      border-radius: 14px;
      display:inline-flex; align-items:center; justify-content:center; gap:10px;
      cursor:pointer;
      user-select:none;
      text-decoration:none;
      box-shadow: 0 10px 30px rgba(0,0,0,.2);
      touch-action: manipulation;
    }
    .btn:active{transform: translateY(1px)}
    .btn.primary{
      border-color: rgba(124,108,255,.40);
      background: linear-gradient(135deg, rgba(124,108,255,.95), rgba(77,211,255,.65));
      color: #0b0f1a;
      font-weight:800;
    }
    .btn.ghost{background: transparent; box-shadow:none;}
    .lang{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.18);
      height: var(--tap);
      border-radius: 14px;
      padding: 0 10px;
      color: var(--text);
    }
    .pill{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      padding: 8px 12px;
      border-radius: 999px;
      color: var(--muted);
      font-size:12px;
    }
    .dot{width:9px;height:9px;border-radius:99px;background:var(--ok); box-shadow: 0 0 0 6px rgba(61,220,151,.12)}
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border: 1px solid rgba(255,255,255,.10);
      border-radius: var(--r28);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .hero{padding: 20px 18px 18px;}
    h1{margin: 18px 0 10px; font-size: 44px; line-height: 1.02; letter-spacing: -1px;}
    @media (max-width: 520px){ h1{font-size: 34px} }
    .sub{color:var(--muted); margin:0 0 18px; max-width: 65ch}
    .cta{display:flex; gap:10px; flex-wrap:wrap; margin-top: 14px}
    .grid{display:grid; grid-template-columns: 1.25fr .75fr; gap: 16px; margin-top: 18px;}
    @media (max-width: 960px){ .grid{grid-template-columns:1fr} }
    .tabs{display:flex; gap:10px; flex-wrap:wrap; padding: 12px 12px 0;}
    .tab{
      flex: 1 1 auto;
      min-width: 120px;
      text-align:center;
      height: var(--tap);
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.12);
      cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      color: var(--muted);
      user-select:none;
      touch-action: manipulation;
    }
    .tab[aria-selected="true"]{
      color: var(--text);
      border-color: rgba(124,108,255,.35);
      background: linear-gradient(135deg, rgba(124,108,255,.26), rgba(77,211,255,.12));
    }
    .section{padding: 14px 18px 18px;}
    .pane{display:none}
    .pane.active{display:block}
    .row{display:grid; gap:10px; margin-top: 10px}
    label{font-size:12px;color:var(--muted)}
    input, textarea{
      width:100%;
      color:var(--text);
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      padding: 12px 14px;
      outline:none;
      min-height: var(--tap);
    }
    textarea{min-height: 96px; resize: vertical}
    input:focus, textarea:focus{
      border-color: rgba(124,108,255,.50);
      box-shadow: 0 0 0 6px rgba(124,108,255,.12);
    }
    .list{display:grid; gap:10px; margin-top:10px}
    .item{
      display:flex; justify-content:space-between; gap:12px; align-items:flex-start;
      padding: 12px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.14);
    }
    .itemBtn{
      width:100%;
      text-align:left;
      cursor:pointer;
    }
    .meta{min-width:0}
    .meta b{display:block}
    .meta span{display:block; color:var(--muted); font-size:12px; margin-top:3px}
    .price{font-weight:900}
    .line{height:1px;background:rgba(255,255,255,.10); margin: 14px 0}
    .small{font-size:12px;color:var(--muted)}
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;}
    .footerbar{
      position:fixed; left:0; right:0; bottom:0; z-index:30;
      padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
      backdrop-filter: blur(16px);
      background: linear-gradient(to top, rgba(7,10,18,.88), rgba(7,10,18,.55));
      border-top: 1px solid rgba(255,255,255,.08);
    }
    .footerbar .nav{
      max-width:var(--max); margin:0 auto;
      display:grid; grid-template-columns: repeat(4,1fr); gap:10px;
    }
    .navbtn{
      height: 52px;
      border-radius: 18px;
      border:1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.12);
      color: var(--muted);
      cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      user-select:none;
      touch-action: manipulation;
      font-weight:700;
    }
    .navbtn.active{
      color: var(--text);
      border-color: rgba(124,108,255,.35);
      background: linear-gradient(135deg, rgba(124,108,255,.26), rgba(77,211,255,.12));
    }
    .adminOnly{display:none !important}
  body.admin .adminOnly{display:none !important}
</style>
</head>
<body>
  <div class="topbar">
    <div class="inner">
      <div class="brand">
        <div class="logo" aria-hidden="true">VV</div>
        <div class="t">
          <b>ViralVault Store</b>
          <span id="envLine">Conectando ao sistema…</span>
        </div>
      </div>

      <div class="actions">
        <select id="lang" class="lang" aria-label="Idioma">
          <option value="pt-BR">PT-BR</option>
          <option value="en">EN</option>
          <option value="es">ES</option>
        </select>

        <a id="discordBtn" class="btn" href="https://discord.gg/fWAWquBu" target="_blank" rel="noopener">Discord</a>
        <button id="installBtn" class="btn ghost" type="button" style="display:none">Instalar</button>
      </div>
    </div>
  </div>

  <main class="wrap">
    <section class="card hero">
      <div class="pill"><span class="dot" aria-hidden="true"></span><span id="heroPill">Checkout PIX • Verificação de pedido • Anti-golpe</span></div>
      <h1 id="heroTitle">Turbine seus itens do Roblox.</h1>
      <p class="sub" id="heroSub">Compra rápida, entrega organizada e suporte no Discord. Gere seu pedido, pague via PIX e acompanhe tudo pelo Order ID.</p>

      <div class="cta">
        <button class="btn primary" id="goCatalog" type="button">Ver catálogo</button>
        <button class="btn" id="goCheckout" type="button">Ir pro checkout</button>
        <button class="btn" id="goOrder" type="button">Ver pedido</button>
      </div>
    </section>

    <div class="grid">
      <section class="card">
        <div class="tabs" role="tablist" aria-label="Navegação">
          <button class="tab" role="tab" aria-selected="true" aria-controls="paneCatalog" id="tabCatalog" type="button">Catálogo</button>
          <button class="tab" role="tab" aria-selected="false" aria-controls="paneCheckout" id="tabCheckout" type="button">Checkout</button>
          <button class="tab" role="tab" aria-selected="false" aria-controls="paneOrder" id="tabOrder" type="button">Pedido</button>
          <button class="tab" role="tab" aria-selected="false" aria-controls="paneFaq" id="tabFaq" type="button">FAQ</button>
        </div>

        <div class="section pane active" id="paneCatalog" role="tabpanel" aria-labelledby="tabCatalog">
          <h3 id="catTitle">Catálogo</h3>
          <p class="small" id="catSub">Toque em um produto para adicionar ao carrinho.</p>

          <div class="row">
            <label for="search" id="searchLbl">Buscar</label>
            <input id="search" placeholder="Ex: brainrot, pack, entrega..." autocomplete="off"/>
          </div>

          <div class="list" id="productList" aria-live="polite"></div>

          <div class="line"></div>

          <div class="small" id="cartLine">Carrinho: <b id="cartCount">0</b> item(s) • Total: <b id="cartTotal">R$ 0,00</b></div>
          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px">
            <button class="btn" id="clearCart" type="button">Limpar</button>
            <button class="btn primary" id="startCheckout" type="button">Finalizar</button>
          </div>
        </div>

        <div class="section pane" id="paneCheckout" role="tabpanel" aria-labelledby="tabCheckout">
          <h3 id="coTitle">Checkout</h3>
          <p class="small" id="coSub">Passo a passo. Sem confusão.</p>

          <div class="row">
            <label for="robloxUser" id="userLbl">Seu user do Roblox (obrigatório)</label>
            <input id="robloxUser" placeholder="Ex: MeuUser_123" autocomplete="username"/>
            <div class="small" id="userHint">Dica: só letras, números e _ (3–20 caracteres).</div>
          </div>

          <div class="row">
            <label id="reviewLbl">Revisão</label>
            <div class="item">
              <div class="meta">
                <b id="reviewItems">0 item(s)</b>
                <span id="reviewTotal">Total: R$ 0,00</span>
              </div>
              <button class="btn" id="openCart" type="button">Ver carrinho</button>
            </div>
          </div>

          <div class="row" style="margin-top:14px">
            <button class="btn primary" id="createOrder" type="button">Gerar Order ID + PIX</button>
            <div class="small" id="coNote">O Order ID é sua prova e também serve para consultar o status.</div>
          </div>

          <div class="line"></div>

          <div class="row">
            <label id="pixLbl">PIX (copia e cola)</label>
            <textarea id="pixBox" readonly class="mono" placeholder="Quando você gerar o pedido, o PIX aparece aqui."></textarea>
            <div style="display:flex; gap:10px; flex-wrap:wrap">
              <button class="btn" id="copyPix" type="button">Copiar PIX</button>
              <button class="btn" id="copyOrder" type="button">Copiar Order ID</button>
            </div>
            <div class="small" id="pixHint">Após pagar, use “Pedido” para acompanhar (created → paid → delivered).</div>
          </div>
        </div>

        <div class="section pane" id="paneOrder" role="tabpanel" aria-labelledby="tabOrder">
          <h3 id="ordTitle">Status do pedido</h3>
          <p class="small" id="ordSub">Verifique se é oficial e veja o andamento.</p>

          <div class="row">
            <label for="orderId" id="orderLbl">Cole o Order ID</label>
            <input id="orderId" placeholder="Ex: vv_..." autocomplete="off" class="mono"/>
          </div>

          <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px">
            <button class="btn primary" id="checkOrder" type="button">Verificar</button>
            <button class="btn" id="loadMyOrders" type="button">Minhas compras</button>
          </div>

          <div class="line"></div>

          <pre id="orderOut" class="mono" style="margin:0; white-space:pre-wrap; color:rgba(255,255,255,.86)"></pre>
        </div>

        <div class="section pane" id="paneFaq" role="tabpanel" aria-labelledby="tabFaq">
          <h3>FAQ</h3>
          <div class="list">
            <div class="item"><div class="meta"><b>Como sei que é oficial?</b><span>Use “Pedido” e verifique o status no sistema oficial.</span></div></div>
            <div class="item"><div class="meta"><b>Quanto tempo para entrega?</b><span>Depende do produto. Prioridade (24h) entrega primeiro.</span></div></div>
            <div class="item">
              <div class="meta"><b>Suporte</b><span>Entre no Discord e abra um ticket/DM.</span></div>
              <a class="btn" href="https://discord.gg/fWAWquBu" target="_blank" rel="noopener">Abrir Discord</a>
            </div>
          </div>

          <div class="line"></div>
        </div>
      </section>

      <aside class="card">
        <div class="section">
          <h3>Painel</h3>
          <div class="small">Status + ações rápidas</div>

          <div class="line"></div>
          <div class="small">Suporte: Discord</div>

          <div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap">
            <button class="btn" id="refreshCatalog" type="button">Recarregar catálogo</button>
            <button class="btn" id="resetLocal" type="button">Reset local</button>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <div class="footerbar" role="navigation" aria-label="Atalhos">
    <div class="nav">
      <button class="navbtn active" id="navCatalog" type="button">Catálogo</button>
      <button class="navbtn" id="navCheckout" type="button">Checkout</button>
      <button class="navbtn" id="navOrder" type="button">Pedido</button>
      <button class="navbtn" id="navFaq" type="button">FAQ</button>
    </div>
  </div>

  <script>
  const CONFIG = {
    API_BASE: "",
    DISCORD_INVITE: "https://discord.gg/fWAWquBu",
    STORAGE_KEY: "viralvault:v10",
    CURRENCY: "BRL"
  };

  const ADMIN_MODE = new URLSearchParams(location.search).has('admin') || localStorage.getItem('vv_admin') === '1';
  if (ADMIN_MODE) document.body.classList.add('admin');

  const I18N = {
    "pt-BR": {},
    "en": {
      heroPill: "PIX checkout • Order verification • Anti-scam",
      heroTitle: "Boost your Roblox items.",
      heroSub: "Fast purchase, organized delivery, support on Discord. Create your order, pay via PIX and track everything by Order ID.",
      catTitle:"Catalog", catSub:"Tap a product to add to cart.", searchLbl:"Search",
      coTitle:"Checkout", coSub:"Step by step. No confusion.", userLbl:"Roblox username (required)",
      userHint:"Tip: letters, numbers and _ (3–20 chars).",
      ordTitle:"Order status", ordSub:"Verify it’s official and track progress.", orderLbl:"Paste the Order ID",
    },
    "es": {
      heroPill: "Checkout PIX • Verificación • Anti-estafa",
      heroTitle: "Mejora tus ítems de Roblox.",
      heroSub: "Compra rápida, entrega organizada y soporte en Discord. Crea tu pedido, paga con PIX y sigue todo por Order ID.",
      catTitle:"Catálogo", catSub:"Toca un producto para añadir al carrito.", searchLbl:"Buscar",
      coTitle:"Checkout", coSub:"Paso a paso. Sin confusión.", userLbl:"Usuario de Roblox (obligatorio)",
      userHint:"Tip: letras, números y _ (3–20 caracteres).",
      ordTitle:"Estado del pedido", ordSub:"Verifica que sea oficial y sigue el progreso.", orderLbl:"Pega el Order ID",
    }
  };

  const $ = (id)=>document.getElementById(id);
  const fmt = (n)=> new Intl.NumberFormat("pt-BR",{style:"currency",currency:CONFIG.CURRENCY}).format(Number(n||0));

  function getStore(){ try { return JSON.parse(localStorage.getItem(CONFIG.STORAGE_KEY) || "{}"); } catch { return {}; } }
  function setStore(v){ localStorage.setItem(CONFIG.STORAGE_KEY, JSON.stringify(v)); }
  function getCart(){ const s=getStore(); return Array.isArray(s.cart)?s.cart:[]; }
  function setCart(cart){ const s=getStore(); s.cart=cart; setStore(s); renderCartLine(); }

  function validateUser(u){ return /^[A-Za-z0-9_]{3,20}$/.test(String(u||"").trim()); }

  async function api(path, opts={}){
    const url = CONFIG.API_BASE.replace(/\/+$/,"") + path;
    const headers = Object.assign({"content-type":"application/json"}, opts.headers||{});
    const res = await fetch(url, Object.assign({}, opts, {headers}));
    const txt = await res.text();
    let data = {};
    try { data = JSON.parse(txt||"{}"); } catch { data = { ok:false, error:"Resposta inválida", raw: txt }; }
    if(!res.ok || data.ok === false) throw new Error(data.error || ("HTTP " + res.status));
    return data;
  }

  const tabs = [
    {tab:"tabCatalog", pane:"paneCatalog", nav:"navCatalog"},
    {tab:"tabCheckout", pane:"paneCheckout", nav:"navCheckout"},
    {tab:"tabOrder", pane:"paneOrder", nav:"navOrder"},
    {tab:"tabFaq", pane:"paneFaq", nav:"navFaq"},
  ];
  function openPane(paneId){
    for(const t of tabs){
      const is = t.pane === paneId;
      $(t.pane).classList.toggle("active", is);
      $(t.tab).setAttribute("aria-selected", is ? "true":"false");
      $(t.nav).classList.toggle("active", is);
    }
    window.scrollTo({top:0, behavior:"smooth"});
  }
  tabs.forEach(t=>{
    $(t.tab).addEventListener("click", ()=> openPane(t.pane));
    $(t.nav).addEventListener("click", ()=> openPane(t.pane));
  });
  $("goCatalog").addEventListener("click", ()=> openPane("paneCatalog"));
  $("goCheckout").addEventListener("click", ()=> openPane("paneCheckout"));
  $("goOrder").addEventListener("click", ()=> openPane("paneOrder"));
  $("startCheckout").addEventListener("click", ()=> openPane("paneCheckout"));

  function renderCartLine(){
    const cart = getCart();
    $("cartCount").textContent = String(cart.length);
    const total = cart.reduce((a,i)=>a+(Number(i.price)||0),0);
    $("cartTotal").textContent = fmt(total);
    $("reviewItems").textContent = cart.length + " item(s)";
    $("reviewTotal").textContent = "Total: " + fmt(total);
  }

  let PRODUCTS = [];
  function escapeHtml(s){ return String(s||"").replace(/[&<>"']/g, m=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;" }[m])); }

  function renderProducts(){
    const q = $("search").value.trim().toLowerCase();
    const list = $("productList");
    list.innerHTML = "";
    const items = PRODUCTS.filter(p=>{
      if(!q) return true;
      return (p.name||"").toLowerCase().includes(q) || (p.id||"").toLowerCase().includes(q) || (p.description||"").toLowerCase().includes(q);
    });
    if(items.length === 0){
      list.innerHTML = '<div class="item"><div class="meta"><b>Nenhum produto</b><span>Tente outro termo de busca.</span></div></div>';
      return;
    }
    for(const p of items){
      const el = document.createElement("button");
      el.type = "button";
      el.className = "item itemBtn";
      el.innerHTML = '<div class="meta"><b>'+escapeHtml(p.name)+'</b><span>'+escapeHtml(p.description||"Toque para adicionar ao carrinho.")+'</span></div><div class="price">'+fmt(p.price)+'</div>';
      el.addEventListener("click", ()=>{
        const cart = getCart();
        cart.push({ id:p.id, name:p.name, price:p.price, ts: Date.now() });
        setCart(cart);
      });
      list.appendChild(el);
    }
  }

  async function loadCatalog(){
    $("productList").innerHTML = '<div class="item"><div class="meta"><b>Carregando…</b><span>Buscando catálogo no sistema.</span></div></div>';
    try{
      const data = await api("/catalog", { method:"GET" });
      PRODUCTS = Array.isArray(data.products) ? data.products : [];
      renderProducts();
    }catch(e){
      $("productList").innerHTML = '<div class="item"><div class="meta"><b>Falha ao carregar</b><span>'+escapeHtml(e.message)+'</span></div></div>';
    }
  }

  $("search").addEventListener("input", renderProducts);
  $("refreshCatalog").addEventListener("click", loadCatalog);

  $("clearCart").addEventListener("click", ()=> setCart([]));

  $("openCart").addEventListener("click", ()=>{
    const cart = getCart();
    if(cart.length === 0) return alert("Carrinho vazio.");
    const total = cart.reduce((a,i)=>a+(Number(i.price)||0),0);
    alert(cart.map((i,idx)=> (idx+1)+". "+i.name+" — "+fmt(i.price)).join("\n") + "\n\nTotal: "+fmt(total));
  });

  $("createOrder").addEventListener("click", async ()=>{
    const user = $("robloxUser").value.trim();
    if(!validateUser(user)) return alert("User obrigatório (3–20, letras/números/_).");
    const cart = getCart();
    if(cart.length === 0) return alert("Carrinho vazio.");
    const first = cart[0];
    $("createOrder").disabled = true;
    try{
      const data = await api("/create-order", { method:"POST", body: JSON.stringify({ productId: first.id, user }) });
      const orderId = data.orderId || (data.order && data.order.orderId) || "";
      const pix = data.pixCopiaECola || "";
      const s = getStore();
      s.lastOrderId = orderId;
      s.lastUser = user;
      s.myOrders = Array.isArray(s.myOrders) ? s.myOrders : [];
      if(orderId) s.myOrders.unshift({ orderId, user, productId:first.id, productName:first.name, price:first.price, createdAt: Date.now(), status:"created" });
      setStore(s);
      if(orderId) $("orderId").value = orderId;
      $("pixBox").value = pix || "PIX não configurado no sistema.";
      openPane("paneCheckout");
    }catch(e){
      alert("Erro: " + e.message);
    }finally{
      $("createOrder").disabled = false;
    }
  });

  $("copyPix").addEventListener("click", async ()=>{
    const v = $("pixBox").value.trim();
    if(!v) return;
    try{ await navigator.clipboard.writeText(v); }catch{ $("pixBox").select(); document.execCommand("copy"); }
  });
  $("copyOrder").addEventListener("click", async ()=>{
    const v = ($("orderId").value||"").trim();
    if(!v) return;
    try{ await navigator.clipboard.writeText(v); }catch{ $("orderId").select(); document.execCommand("copy"); }
  });

  $("checkOrder").addEventListener("click", async ()=>{
    const orderId = $("orderId").value.trim();
    if(!orderId) return alert("Cole um Order ID.");
    $("orderOut").textContent = "Consultando…";
    try{
      const data = await api("/order-status?orderId=" + encodeURIComponent(orderId), { method:"GET" });
      $("orderOut").textContent = JSON.stringify(data.order, null, 2);
    }catch(e){
      $("orderOut").textContent = JSON.stringify({ ok:false, error:e.message }, null, 2);
    }
  });

  $("loadMyOrders").addEventListener("click", ()=>{
    const s = getStore();
    const arr = Array.isArray(s.myOrders) ? s.myOrders : [];
    $("orderOut").textContent = JSON.stringify(arr.slice(0,20), null, 2);
  });

  $("resetLocal").addEventListener("click", ()=>{
    localStorage.removeItem(CONFIG.STORAGE_KEY);
    $("pixBox").value = "";
    $("orderOut").textContent = "";
    setCart([]);
    loadCatalog();
  });

  function applyLang(lang){
    const d = I18N[lang] || {};
    if(d.heroPill) $("heroPill").textContent = d.heroPill;
    if(d.heroTitle) $("heroTitle").textContent = d.heroTitle;
    if(d.heroSub) $("heroSub").textContent = d.heroSub;
    if(d.catTitle) $("catTitle").textContent = d.catTitle;
    if(d.catSub) $("catSub").textContent = d.catSub;
    if(d.searchLbl) $("searchLbl").textContent = d.searchLbl;
    if(d.coTitle) $("coTitle").textContent = d.coTitle;
    if(d.coSub) $("coSub").textContent = d.coSub;
    if(d.userLbl) $("userLbl").textContent = d.userLbl;
    if(d.userHint) $("userHint").textContent = d.userHint;
    if(d.ordTitle) $("ordTitle").textContent = d.ordTitle;
    if(d.ordSub) $("ordSub").textContent = d.ordSub;
    if(d.orderLbl) $("orderLbl").textContent = d.orderLbl;
    const s=getStore(); s.lang=lang; setStore(s);
    document.documentElement.lang = lang;
  }
  $("lang").addEventListener("change", (e)=> applyLang(e.target.value));

  (async function init(){
    if (ADMIN_MODE) {
    document.body.classList.add("admin");
      $("apiUrl").textContent = CONFIG.API_BASE;
} else {
      $("apiUrl").textContent = "";
}
    const s = getStore();
    if(s.lang) $("lang").value = s.lang;
    applyLang($("lang").value);
    if(s.lastOrderId) $("orderId").value = s.lastOrderId;
    if(s.lastUser) $("robloxUser").value = s.lastUser;
    renderCartLine();
    try{
      const home = await api("/", { method:"GET" });
      $("envLine").textContent = "Sistema online";
    }catch{
      $("envLine").textContent = "Conexão instável • tente novamente";
    }
    await loadCatalog();
  })();

  // PWA: manifest + SW (blob)
  const manifest = {
    name: "ViralVault Store",
    short_name: "ViralVault",
    start_url: ".",
    scope: ".",
    display: "standalone",
    background_color: "#070a12",
    theme_color: "#0b0f1a",
    icons: [
      { src: "data:image/svg+xml," + encodeURIComponent(svgIcon("#7c6cff","#4dd3ff")), sizes:"192x192", type:"image/svg+xml" },
      { src: "data:image/svg+xml," + encodeURIComponent(svgIcon("#7c6cff","#4dd3ff")), sizes:"512x512", type:"image/svg+xml" }
    ]
  };
  function svgIcon(a,b){
    return `<svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512">
      <defs><linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0" stop-color="${a}"/><stop offset="1" stop-color="${b}"/></linearGradient></defs>
      <rect width="512" height="512" rx="140" fill="url(#g)"/>
      <text x="50%" y="54%" text-anchor="middle" font-family="Arial, sans-serif" font-size="210" font-weight="900" fill="#0b0f1a">VV</text>
    </svg>`;
  }
  const murl = URL.createObjectURL(new Blob([JSON.stringify(manifest)], {type:"application/manifest+json"}));
  const ml = document.createElement("link"); ml.rel="manifest"; ml.href=murl; document.head.appendChild(ml);

  if("serviceWorker" in navigator){
    const swCode = `
      const CACHE = "viralvault-v10";
      self.addEventListener("install", (e)=> e.waitUntil(caches.open(CACHE).then(c=>c.addAll(["./"])).then(()=>self.skipWaiting())));
      self.addEventListener("activate", (e)=> e.waitUntil(self.clients.claim()));
      self.addEventListener("fetch", (e)=>{
        const req=e.request;
        if(req.method!=="GET") return;
        const url=new URL(req.url);
        if(url.origin===location.origin){
          e.respondWith(caches.match(req).then(c=>c||fetch(req).then(r=>{const rc=r.clone();caches.open(CACHE).then(cache=>cache.put(req,rc));return r;})));
        }
      });
    `;
    const swUrl = URL.createObjectURL(new Blob([swCode], {type:"text/javascript"}));
    navigator.serviceWorker.register(swUrl).catch(()=>{});
  }

  let deferredPrompt=null;
  window.addEventListener("beforeinstallprompt",(e)=>{
    e.preventDefault();
    deferredPrompt=e;
    $("installBtn").style.display="";
  });
  $("installBtn").addEventListener("click", async ()=>{
    if(!deferredPrompt) return;
    deferredPrompt.prompt();
    await deferredPrompt.userChoice;
    deferredPrompt=null;
    $("installBtn").style.display="none";
  });
  </script>
</body>
</html>
